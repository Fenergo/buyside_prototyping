<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FundBot Onboarding — Teal UI (Arrows + 5s Animation)</title>
  <style>
    :root{
      --teal-600:#009CA6; --teal-500:#00B4BE; --teal-100:#E6F7F8;
      --blue-50:#EAF2FF; --blue-200:#D6E6FF; --blue-600:#2563EB;
      --green-500:#16A34A; --green-600:#15803D;
      --slate-900:#0F172A; --slate-600:#475569; --slate-200:#E2E8F0; --slate-100:#F1F5F9;
      --white:#fff; --shadow:0 6px 24px rgba(15,23,42,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--slate-100); color:var(--slate-900);}
    .wrap{max-width:460px;margin:18px auto;padding:0 12px}
    .card{display:flex;flex-direction:column;background:var(--white);border-radius:18px;box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--slate-200);height:calc(100vh - 36px);max-height:820px}
    .app-header{display:flex;align-items:center;gap:10px;padding:12px;background:linear-gradient(90deg,var(--teal-600),var(--teal-500));color:#fff}
    .brand-icon{width:40px;height:40px;border-radius:12px;background:rgba(255,255,255,.18);display:grid;place-items:center;border:1px solid rgba(255,255,255,.25)}
    .brand-icon svg{width:22px;height:22px;opacity:.95}
    .headings{display:flex;flex-direction:column;min-width:0}
    .title{font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .subtitle{font-size:12px;opacity:.9}
    .spacer{flex:1}
    .pill{font-weight:700;background:rgba(255,255,255,.16);border:1px solid rgba(255,255,255,.28);padding:6px 10px;border-radius:999px;margin-right:6px}
    .icon-btn{width:36px;height:36px;border-radius:999px;display:grid;place-items:center;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.28);cursor:pointer;user-select:none;transition:transform .08s ease,background .15s ease,opacity .15s ease}
    .icon-btn:hover{background:rgba(255,255,255,.28)} .icon-btn:active{transform:scale(.96)} .icon-btn[disabled]{opacity:.45;cursor:not-allowed}
    .icon-btn svg{width:18px;height:18px;color:#fff}
    .chat{position:relative;padding:16px;overflow:auto;flex:1;background:var(--white)}
    .row{display:flex;gap:10px;margin:10px 0;align-items:flex-start}
    .row.right{flex-direction:row-reverse}
    .avatar{width:36px;height:36px;border-radius:999px;display:grid;place-items:center;font-weight:700;color:#fff;background:linear-gradient(135deg,#6aa0ff,#3e6af2);border:2px solid #fff;box-shadow:0 0 0 2px rgba(37,99,235,.2);overflow:hidden;flex:0 0 36px}
    .avatar.user{background:linear-gradient(135deg,#4ade80,#22c55e);box-shadow:0 0 0 2px rgba(34,197,94,.25)}
    .avatar.bot{background:linear-gradient(135deg,#8b5cf6,#6d28d9);box-shadow:0 0 0 2px rgba(139,92,246,.25)}
    .content{max-width:75%}
    .meta{font-size:12px;margin-bottom:6px;color:var(--blue-600)}
    .meta.user{color:var(--green-600);text-align:right}
    .meta.bot{color:#6d28d9}
    .bubble{padding:12px 14px;border-radius:16px;border:1px solid var(--slate-200);background:var(--blue-50);color:#0f172a}
    .row.right .bubble{background:var(--green-500);border-color:transparent;color:#fff;border-radius:16px}
    .bubble.bot{background:#F2ECFF;border-color:#E6DAFF}
    .footer{border-top:1px solid var(--slate-200);background:var(--white);padding:12px;text-align:center;color:#0b2339;font-weight:700;letter-spacing:.3px}
    .hidden{display:none}
    a{color:#0f62fe;text-decoration:underline;text-underline-offset:2px}
    .action{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .fake-upload{border:1px dashed var(--slate-200);background: var(--slate-100);color:#475569;padding:8px 10px;border-radius:12px;font-size:13px}
    .fake-upload label{margin-left:8px;padding:6px 10px;border-radius:8px;background:#fff;border:1px solid var(--slate-200);cursor:pointer}
    .action button{padding:6px 10px;border-radius:999px;border:1px solid var(--slate-200);background: var(--slate-100);cursor:pointer}
    .action button:disabled{opacity:.6}
    .empty-hint{position:absolute;inset:0;display:grid;place-items:center;pointer-events:auto}
    .hint-pill{display:inline-flex;align-items:center;gap:10px;background:var(--teal-100);border:1px solid var(--slate-200);padding:10px 14px;border-radius:999px;color:#065f63;font-weight:600;box-shadow:0 4px 14px rgba(0,0,0,.08);cursor:pointer}
    .kbd{font-family:ui-monospace,Menlo,monospace;font-size:12px;padding:4px 8px;border-radius:8px;background:#fff;border:1px solid var(--slate-200);color:#0f172a}
    .status{position:absolute;right:12px;bottom:12px;font-size:12px;color:#475569;background:#fff;border:1px solid var(--slate-200);padding:4px 8px;border-radius:8px}

    /* 5s message animation (typing + progress + fade-in) */
    .typing{display:inline-flex;align-items:center;gap:6px;background:var(--teal-100);border:1px dashed var(--slate-200);color:#065f63;padding:8px 10px;border-radius:14px;font-size:13px}
    .dot{width:6px;height:6px;border-radius:999px;background:#00a2ac;opacity:.4;animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,60%,100%{opacity:.2}30%{opacity:1}}
    .revealbar{height:2px;background:var(--slate-200);border-radius:999px;overflow:hidden;margin-top:8px}
    .reveal{height:100%;width:0%;background:linear-gradient(90deg,var(--teal-600),var(--teal-500));animation:fill 5s linear forwards}
    @keyframes fill{to{width:100%}}
    .fadein{animation:fadeIn .24s ease-out both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card" aria-label="Chat card" tabindex="-1">
      <header class="app-header">
        <div class="brand-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M3 21h18M6 21V6h12v15M9 21V3h6v18M9 7h6M9 11h6M9 15h6" />
          </svg>
        </div>
        <div class="headings">
          <div class="title">Global Growth Partners III</div>
          <div class="subtitle">Investment Onboarding</div>
        </div>
        <div class="spacer"></div>
        <div class="pill">FundBot</div>
        <button class="icon-btn" id="prevBtn" title="Previous (←)" aria-label="Previous">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 5l-7 7 7 7"/></svg>
        </button>
        <button class="icon-btn" id="nextBtn" title="Next (→)" aria-label="Next">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.5 5l7 7-7 7"/></svg>
        </button>
        <button class="icon-btn" id="resetBtn" title="Restart (R)" aria-label="Restart">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <path d="M21 12a9 9 0 1 1-3-6.7"></path>
            <path d="M21 3v6h-6"></path>
          </svg>
        </button>
      </header>

      <div class="chat" id="messages" aria-live="polite" aria-label="Conversation">
        <div class="empty-hint" id="emptyHint">
          <div class="hint-pill" id="hintStart"><span>Start demo</span><span class="kbd">→</span></div>
        </div>
        <div class="status" id="status">0 / 19</div>
      </div>

  <footer class="footer"><img src="fen_logo.jpg" alt="Fenergo" style="height:28px;width:auto;vertical-align:middle;display:inline-block" /></footer>
    </section>
  </div>

  <template id="rowTpl">
    <div class="row fadein">
      <div class="avatar">AM</div>
      <div class="content">
        <div class="meta">Asset Manager • 9:14 AM</div>
        <div class="bubble">Message text</div>
      </div>
    </div>
  </template>

  <script>
    const messages = [
      {id:1, actor:"Asset Manager", sender:"asset", time:"9:14 AM",
       text:`Hi Mr. Evans—thanks for your interest in Global Growth Partners III. We’ve just launched and would be delighted to have you participate. Here’s our marketing page with the investment thesis, target securities/assets, and a 5‑year forecast chart: <a href="https://example.com/funds/global-growth-partners-iii" target="_blank" rel="noopener">https://example.com/funds/global-growth-partners-iii</a>. (Illustrative only—see PPM/LPA for definitive terms.)`},
      {id:2, actor:"Mr. Evans", sender:"user", time:"9:16 AM",
       text:`Thanks. What’s the minimum investment amount?`},
      {id:3, actor:"Asset Manager", sender:"asset", time:"9:17 AM",
       text:`Minimum commitment is USD 250,000 (higher in USD 50,000 increments).`},
      {id:4, actor:"Mr. Evans", sender:"user", time:"9:18 AM",
       text:`Is there any lock‑in period?`},
      {id:5, actor:"Asset Manager", sender:"asset", time:"9:19 AM",
       text:`It’s a closed‑end private equity structure—commitments are locked for the life of the fund (target 10 years, with up to two 1‑year extensions). No early redemptions. Capital is called during a ~5‑year investment period and distributions occur from realizations.`},
      {id:6, actor:"Mr. Evans", sender:"user", time:"9:21 AM",
       text:`Understood. What’s the management fee?`},
      {id:7, actor:"Asset Manager", sender:"asset", time:"9:22 AM",
       text:`2.0% p.a. on committed capital during the investment period, stepping down to 1.5% p.a. on invested capital thereafter (accrues quarterly; full details in the PPM).`},
      {id:8, actor:"Asset Manager", sender:"asset", time:"9:23 AM",
       text:`Great—if you’re ready, our AI assistant FundBot will guide you through onboarding and compliance.`},
      {id:9, actor:"FundBot", sender:"bot", time:"9:23 AM",
       text:`Welcome, Mr. Evans. I’m FundBot, your guide for the onboarding process. I will ask you a series of compliance questions and request necessary documentation to comply with international AML and KYC regulations. Let’s begin with your identity verification. Please upload a clear scan or photograph of your government‑issued photo identification (passport or driver’s license) and a recent proof of address (utility bill or bank statement, dated within the last three months).`, action:'upload'},
      {id:10, actor:"Mr. Evans", sender:"user", time:"9:28 AM",
       text:`I’ve just uploaded my passport and a utility bill. Is there anything else you need to verify my personal identity?`},
      {id:11, actor:"FundBot", sender:"bot", time:"9:29 AM",
       text:`Thank you. I have received the documents and the system is verifying them now. The next crucial step is determining your SOW and SOF. Please provide a brief description of the origin of the funds you intend to invest and upload supporting documentation, such as bank statements, tax returns, or employment records.`, action:'upload'},
      {id:12, actor:"Mr. Evans", sender:"user", time:"9:32 AM",
       text:`The funds are from the sale of my previous business last year. I will upload the closing statement from the sale now, along with my most recent tax return.`},
      {id:13, actor:"FundBot", sender:"bot", time:"9:33 AM",
       text:`Excellent. Now we move to the Related Parties section, which is critical for identifying potential conflicts of interest or PEPs. Do you, or any immediate family member (spouse, parents, or children), hold a prominent public function, or are you closely associated with any such person?`, action:'choice', options:['No','Yes']},
      {id:14, actor:"Mr. Evans", sender:"user", time:"9:34 AM",
       text:`No, I don’t hold any public office, and neither does my immediate family.`},
      {id:15, actor:"FundBot", sender:"bot", time:"9:35 AM",
       text:`Thank you for confirming. Finally, in compliance with FATCA and CRS regulations, we require information on any associated entities or trusts that will be holding a direct or indirect interest in this investment. Are you investing as an individual, or through a corporate vehicle, foundation, or trust?`, action:'choice', options:['Individual','Corporate / Trust']},
      {id:16, actor:"Mr. Evans", sender:"user", time:"9:36 AM",
       text:`I am investing through my personal holding company, “Evans Capital Inc.”`},
      {id:17, actor:"FundBot", sender:"bot", time:"9:37 AM",
       text:`Understood. Please upload the Certificate of Incorporation and the Shareholders Register for Evans Capital Inc. Once those documents are processed, and your initial KYC documents pass verification, your account will be ready for the final commitment signature.`, action:'upload'},
      {id:18, actor:"Mr. Evans", sender:"user", time:"9:39 AM",
       text:`Okay, uploading those two corporate documents now. How long will the final verification take?`},
      {id:19, actor:"FundBot", sender:"bot", time:"9:40 AM",
       text:`Initial document screening is typically complete within four business hours. I will notify you immediately via email once your account is ready for the final signing of the Limited Partnership Agreement (LPA). Thank you for completing your onboarding compliance, Mr. Evans.`}
    ];

    const $ = s => document.querySelector(s);
    const list = $('#messages');
    const tpl = $('#rowTpl');
    const prevBtn = $('#prevBtn');
    const nextBtn = $('#nextBtn');
    const resetBtn = $('#resetBtn');
    const emptyHint = $('#emptyHint');
    const hintStart = $('#hintStart');
    const status = $('#status');

    let idx = 0; // number of visible messages (start blank)
    let animating = false;
    let animTimer = null;

    function avatarClass(sender){ return sender==='user' ? 'avatar user' : sender==='bot' ? 'avatar bot' : 'avatar'; }
    function bubbleClass(sender){ return sender==='user' ? 'bubble user' : sender==='bot' ? 'bubble bot' : 'bubble'; }
    function rowSide(sender){ return sender==='user' ? 'row right' : 'row'; }
    function metaColor(sender){ return sender==='user' ? 'user' : sender==='bot' ? 'bot' : ''; }

    function addActionUI(container, msg){
      if(msg.action === 'upload'){
        const el = document.createElement('div');
        el.className = 'action';
        el.innerHTML = `<div class="fake-upload"><strong>Upload</strong><label tabindex="0">Choose files<input type="file" class="hidden" multiple></label></div>`;
        container.appendChild(el);
      }
      if(msg.action === 'choice' && Array.isArray(msg.options)){
        const el = document.createElement('div');
        el.className = 'action';
        for(const opt of msg.options){
          const b = document.createElement('button');
          b.textContent = opt;
          b.addEventListener('click', ()=>{ el.querySelectorAll('button').forEach(x=>x.disabled=true); });
          el.appendChild(b);
        }
        container.appendChild(el);
      }
    }

    function renderMessage(m){
      const row = tpl.content.firstElementChild.cloneNode(true);
      row.className = rowSide(m.sender) + ' fadein';
      row.querySelector('.avatar').className = avatarClass(m.sender);
      row.querySelector('.avatar').textContent = m.sender==='user' ? 'ME' : (m.sender==='bot' ? 'FB' : 'AM');
      const meta = row.querySelector('.meta');
      const cls = metaColor(m.sender);
      if(cls) meta.classList.add(cls);
      meta.textContent = `${m.actor} • ${m.time}`;
      const bubble = row.querySelector('.bubble');
      bubble.className = bubbleClass(m.sender);
      bubble.innerHTML = m.text;
      addActionUI(row.querySelector('.content'), m);
      list.appendChild(row);
    }

    function renderMessageAnimated(m){
      const row = tpl.content.firstElementChild.cloneNode(true);
      row.className = rowSide(m.sender) + ' fadein';
      row.querySelector('.avatar').className = avatarClass(m.sender);
      row.querySelector('.avatar').textContent = m.sender==='user' ? 'ME' : (m.sender==='bot' ? 'FB' : 'AM');
      const meta = row.querySelector('.meta');
      const cls = metaColor(m.sender);
      if(cls) meta.classList.add(cls);
      meta.textContent = `${m.actor} • ${m.time}`;
      const bubble = row.querySelector('.bubble');
      bubble.className = bubbleClass(m.sender);
      // Loading placeholder (typing + 5s progress)
      bubble.innerHTML = `<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span>&nbsp;typing…</span></div><div class="revealbar"><div class="reveal"></div></div>`;
      list.appendChild(row);
      // Disable "next" while animating; prev/reset still work
      animating = true; updateButtons();
      // After 5s, reveal content and actions
      animTimer = setTimeout(()=>{
        bubble.innerHTML = m.text;
        addActionUI(row.querySelector('.content'), m);
        animating = false; animTimer = null; updateButtons();
        list.lastElementChild?.scrollIntoView({block:'end'});
      }, 5000);
    }

    function cancelAnimation(){
      if(animTimer){ clearTimeout(animTimer); animTimer = null; }
      animating = false;
    }

    function renderSlice(n, {animateLast=false} = {}){
      // Cancel any pending animation to avoid updating removed nodes
      cancelAnimation();
      list.innerHTML = '';
      emptyHint.classList.toggle('hidden', n > 0);
      const count = Math.max(0, Math.min(n, messages.length));
      for(let k=0; k<count; k++){
        if(animateLast && k === count-1){
          renderMessageAnimated(messages[k]);
        }else{
          renderMessage(messages[k]);
        }
      }
      list.lastElementChild?.scrollIntoView({block:'end'});
      if(!animateLast) updateButtons();
    }

    function updateButtons(){
      prevBtn.disabled = (idx <= 0);
      nextBtn.disabled = animating || (idx >= messages.length);
      status.textContent = `${idx} / ${messages.length}` + (animating ? ' • animating' : '');
    }

    function goNext(){
      if(animating) return;
      if(idx < messages.length){
        idx++;
        renderSlice(idx, {animateLast:true});
      }
    }
    function goPrev(){
      cancelAnimation();
      if(idx > 0){ idx--; renderSlice(idx); }
    }
    function reset(){ cancelAnimation(); idx = 0; renderSlice(idx); }

    function handleKey(e){
      const key = e.key || e.code;
      const code = e.keyCode || e.which;
      if(key === 'ArrowRight' || code === 39){ e.preventDefault(); goNext(); }
      else if(key === 'ArrowLeft' || code === 37){ e.preventDefault(); goPrev(); }
      else if(key === 'Home'){ e.preventDefault(); idx = 0; renderSlice(idx); }
      else if(key === 'End'){ e.preventDefault(); idx = messages.length; renderSlice(idx); }
      else if(key && (key.toLowerCase?.() === 'r')){ e.preventDefault(); reset(); }
    }

    nextBtn.addEventListener('click', goNext);
    prevBtn.addEventListener('click', goPrev);
    resetBtn.addEventListener('click', reset);
    hintStart.addEventListener('click', goNext);
    window.addEventListener('keydown', handleKey, true);
    document.addEventListener('keydown', handleKey, true);

    window.addEventListener('load', () => {
      const card = document.querySelector('.card');
      card?.focus({ preventScroll:true });
      renderSlice(idx); // initial (blank)
    });
  </script>
</body>
</html>
