<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fund Launch · KYC Orchestrator</title>
  <style>
:root{
  --page:#ffffff; --text:#0f172a; --muted:#475569; --line:#e5e7eb; --card:#ffffff;
  --sidebar: rgba(33,207,178,0.20); --btn: rgba(33,207,178,0.60); --btn-border: rgba(33,207,178,0.60);
  --btn-text:#0b1220; --link:#0ea5e9; --task:#a399ff; --success:#059669; --warn:#d97706; --danger:#dc2626; --info:#2563eb; --progress:#21cfb2;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; background: var(--page); color:var(--text); line-height:1.45;}
a{color:var(--link); text-decoration:none} a:hover{text-decoration:underline}
.app{display:grid; grid-template-columns: 280px 1fr; min-height:100vh}
.sidebar{background: var(--sidebar); border-right:1px solid var(--line); padding:18px 14px; position:sticky; top:0; height:100vh; overflow:auto;}
.brand{display:flex; align-items:center; gap:10px; margin:8px 6px 14px 6px;}
.brand .logo{width:34px; height:34px; border-radius:8px; background: radial-gradient(circle at 25% 20%, rgba(33,207,178,0.9) 0%, rgba(33,207,178,0.6) 45%, rgba(33,207,178,0.4) 80%); box-shadow:0 8px 24px rgba(33,207,178,.35);}
.brand h1{font-size:18px; letter-spacing:.3px; margin:0}
.nav{margin-top:10px}
.nav a{display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:10px; color:#0b1220; border:1px solid transparent;}
.nav a:hover{background:rgba(33,207,178,0.12); border-color:rgba(33,207,178,0.18); text-decoration:none}
.nav a.active{background: rgba(33,207,178,0.18); border-color:rgba(33,207,178,0.28); color:#0b1220; box-shadow: inset 0 0 0 1px rgba(33,207,178,0.20);}
.nav .icon{width:18px; height:18px; display:inline-block}
.nav .tag{margin-left:auto; font-size:12px; padding:2px 8px; border-radius:999px; background:rgba(33,207,178,0.18); color:#0b1220; border:1px solid rgba(33,207,178,0.28)}
.footer-note{margin-top:18px; font-size:12px; color:var(--muted); opacity:.85; padding:0 6px}
.header{display:flex; align-items:center; justify-content:space-between; padding:16px 22px; position:sticky; top:0; z-index:5; background:rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-bottom: 1px solid var(--line);}
.search{display:flex; align-items:center; gap:8px; border:1px solid var(--line); background: var(--card); padding:10px 12px; border-radius:12px; width:52%;}
.search input{flex:1; background:transparent; border:none; outline:none; color:var(--text);}
.actions{display:flex; align-items:center; gap:10px}
.btn{background: var(--btn); border:1px solid var(--btn-border); color:var(--btn-text); padding:10px 12px; border-radius:10px; cursor:pointer; transition: filter .15s ease, transform .02s ease;}
.btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)} .btn.primary{background: var(--btn); border-color: var(--btn-border)} .btn.ghost{background:transparent; color: var(--btn-text); border-color: var(--btn-border)} .btn.small{padding:6px 10px; font-size:12px}
.kbd{font: 12px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas; padding:2px 6px; border-radius:6px; border:1px solid var(--line); color:var(--muted)}
.content{padding:14px 22px 40px}
.page-title{display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin:12px 0 8px 0}
.page-title h2{margin:0; font-size:22px}
.page-title .sub{color:var(--muted)}
.cards{display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:14px; margin:14px 0 6px}
.card{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:12px 14px; min-height:72px; box-shadow: 0 8px 28px rgba(2,6,23,.06);}
.card .label{color:var(--muted); font-size:12px} .card .value{font-size:22px; margin-top:2px} .card .trend{font-size:12px; color:#047857} .card .danger{color:var(--danger)}
.grid-2{display:grid; grid-template-columns: 2fr 1fr; gap:16px; margin-top:16px} .grid-3{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-top:16px}
.section{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:16px} .section h3{margin:0 0 10px 0; font-size:16px}
.table{width:100%; border-collapse:separate; border-spacing:0 8px; font-size:14px}
.table th{color:var(--muted); text-align:left; font-weight:600; padding:8px 10px; border-bottom:1px solid var(--line)}
.table td{padding:10px; background:#ffffff; border:1px solid var(--line)}
.table tr td:first-child{border-top-left-radius:10px; border-bottom-left-radius:10px} .table tr td:last-child{border-top-right-radius:10px; border-bottom-right-radius:10px}
.badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; color:#0b1220}
.badge.ok{border-color:#065f46; background:#ecfdf5; color:#065f46} .badge.warn{border-color:#92400e; background:#fffbeb; color:#92400e}
.badge.danger{border-color:#7f1d1d; background:#fef2f2; color:#7f1d1d} .badge.info{border-color:#1e3a8a; background:#eff6ff; color:#1e3a8a} .badge.task{border-color:#6f63ff; background:#a399ff; color:#ffffff}
.pills{display:flex; gap:8px; flex-wrap:wrap}
.pill{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; cursor:pointer; font-size:12px; color:#0b1220}
.pill.active{background:rgba(33,207,178,0.18); border-color:rgba(33,207,178,0.28)}
.progress{width:100%; height:10px; border-radius:999px; background:#f1f5f9; border:1px solid var(--line); overflow:hidden}
.progress > span{display:block; height:100%; background:linear-gradient(90deg, var(--progress), rgba(33,207,178,0.85)); width:0%}
.stepper{display:flex; gap:10px; flex-wrap:wrap}
.step{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; border:1px dashed #94a3b8; background:#f8fafc; color:#0b1220}
.step.current{border-style:solid; background:rgba(33,207,178,0.10)} .step .dot{width:10px; height:10px; border-radius:50%; background:#94a3b8; border:2px solid #cbd5e1}
.step.done .dot{background:#059669; border-color:#059669} .step.current .dot{background:var(--progress)}
.form-grid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px}
.label{font-size:12px; color:var(--muted); margin-bottom:6px}
.input, select, textarea{width:100%; background:#ffffff; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px 12px}
.row{display:flex; gap:10px; align-items:center} hr.sep{border:0; border-top:1px solid var(--line); margin:14px 0}
.right{margin-left:auto} .muted{color:var(--muted)} .small{font-size:12px} .space-top{margin-top:10px} .center{display:flex; align-items:center; justify-content:center} .hidden{display:none!important}
/* Collapsible tracker */
.tracker .head{display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none}
.chev{width:12px; height:12px; border-right:2px solid #334155; border-bottom:2px solid #334155; transform:rotate(45deg); transition: transform .15s ease;}
.tracker.collapsed .chev{transform:rotate(-135deg)}
.tracker .meta{display:flex; gap:12px; flex-wrap:wrap; margin-left:auto}
.stat{display:flex; gap:6px; align-items:center; font-size:12px; border:1px solid var(--line); border-radius:999px; padding:4px 8px; background:#f8fafc}
.stat b{font-weight:700}
.tracker-body{margin-top:10px}
/* Modal */
.modal{position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:999}
.modal .box{background:#fff; border-radius:12px; border:1px solid var(--line); width:min(640px, 92vw); padding:16px; box-shadow:0 20px 60px rgba(0,0,0,.25)}
.modal .box h4{margin:0 0 8px 0}
.modal .box .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
@media (max-width:1100px){ .app{grid-template-columns: 80px 1fr} .brand h1, .footer-note, .nav a .text, .nav a .tag{display:none} .nav a{justify-content:center} .search{width:70%} }
@media (max-width:800px){ .cards{grid-template-columns: repeat(2, 1fr)} .grid-2{grid-template-columns: 1fr} .grid-3{grid-template-columns: 1fr} .form-grid{grid-template-columns: 1fr} }
</style>
</head>
<body data-page="fund-launch">
  <a href="#main" class="kbd" style="position:absolute; left:-9999px; top:-9999px">Skip to content</a>
  <div class="app">
    
    <aside class="sidebar" aria-label="Sidebar Navigation">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>KYC Orchestrator</h1>
      </div>
      <nav class="nav">
        <a href="index.html" data-nav="dashboard" aria-label="Dashboard">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12l9-9 9 9" stroke="#0b1220" stroke-width="1.5"/><path d="M5 10v10h5v-6h4v6h5V10" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Dashboard</span>
        </a>
        <a href="fund-launch.html" data-nav="fund-launch" aria-label="Fund Launch">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 19h16M7 19V7a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v12" stroke="#0b1220" stroke-width="1.5"/><path d="M9 9h6m-6 4h6" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Fund Launch</span>
          <span class="tag">Product</span>
        </a>
        <a href="distributor-onboarding.html" data-nav="distributor" aria-label="Distributor Onboarding">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 8h10a4 4 0 0 1 4 4v6H3v-6a4 4 0 0 1 4-4z" stroke="#0b1220" stroke-width="1.5"/><path d="M7 8V6a5 5 0 0 1 10 0v2" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Distributor Onboarding</span>
          <span class="tag">KYD</span>
        </a>
        <a href="investor-onboarding.html" data-nav="investor" aria-label="Investor Onboarding">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5z" stroke="#0b1220" stroke-width="1.5"/><path d="M3 21a9 9 0 0 1 18 0" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Investor Onboarding</span>
          <span class="tag">KYC/KYB</span>
        </a>
        <a href="asset-dd.html" data-nav="asset" aria-label="Asset & Vehicle Due Diligence">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 7h18M3 12h18M3 17h18" stroke="#0b1220" stroke-width="1.5"/><path d="M8 7v12m8-12v12" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Asset & Vehicle DD</span>
          <span class="tag">KYI</span>
        </a>
        <a href="monitoring.html" data-nav="monitoring" aria-label="Monitoring & Screening">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 13l4 4 12-12" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Monitoring & Screening</span>
          <span class="tag">KYT</span>
        </a>
        <a href="digital-trading.html" data-nav="digital" aria-label="Digital Trading">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16v12H4z" stroke="#0b1220" stroke-width="1.5"/><path d="M8 10h8M8 14h5" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Digital Trading</span>
          <span class="tag">Trades</span>
        </a>
      </nav>
      <div class="footer-note">Prototype • Static HTML • Local storage</div>
    </aside>

    <main class="main">
      <header class="header" role="banner">
        <div class="search" role="search" aria-label="Search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke="#64748b" stroke-width="1.5"/><path d="M20 20l-3-3" stroke="#64748b" stroke-width="1.5"/></svg>
          <input placeholder="Search parties, products, accounts, cases… (press / to focus)" aria-label="Global search"/>
          <span class="kbd">/</span>
        </div>
        <div class="actions">
          <button class="btn ghost" aria-label="New case">New Case</button>
          <button class="btn primary" aria-label="Add party">+ Add Party</button>
        </div>
      </header>
      <section class="content" id="main">
        <div class="page-title">
          <h2>Fund Launch</h2>
          <div class="sub">Product governance • SFDR/EET • KYD • Approvals</div>
        </div>
        
<div class="section">
  <h3>Fund Launch — Journey</h3>
  <div class="stepper" role="list">
    <div class="step done" role="listitem"><div class="dot" aria-hidden="true"></div> Product Intake</div>
    <div class="step current" role="listitem"><div class="dot" aria-hidden="true"></div> Policy Assessment</div>
    <div class="step" role="listitem"><div class="dot" aria-hidden="true"></div> Distributor Readiness</div>
    <div class="step" role="listitem"><div class="dot" aria-hidden="true"></div> ESG Pack (SFDR/EET)</div>
    <div class="step" role="listitem"><div class="dot" aria-hidden="true"></div> Screening & Approvals</div>
    <div class="step" role="listitem"><div class="dot" aria-hidden="true"></div> Launch & Publish</div>
  </div>
</div>

<div class="grid-2" id="launchForm" data-id="">
  <div class="section">
    <h3>Product Details</h3>
    <div class="form-grid">
      <div><div class="label">Fund Name</div><input id="fName" class="input" placeholder="e.g., Northshore Growth AIF"/></div>
      <div><div class="label">Jurisdiction</div>
        <select id="fJur">
          <option>Luxembourg</option><option>Ireland</option><option>UK</option><option>US</option>
        </select>
      </div>
      <div><div class="label">Vehicle Type</div><select id="fVeh"><option>UCITS</option><option>AIF</option></select></div>
      <div><div class="label">SFDR Classification</div><select id="sfdrSel"><option>Article 6</option><option>Article 8</option><option>Article 9</option></select></div>
      <div><div class="label">Leverage</div><input id="fLev" class="input" placeholder="e.g., 2.0x"/></div>
      <div><div class="label">Liquidity</div><select id="fLiq"><option>Daily</option><option>Weekly</option><option>Monthly</option><option>Quarterly</option></select></div>
      <div><div class="label">Target Market</div><input id="fTgt" class="input" placeholder="e.g., Professional investors in DE/FR/NL"/></div>
      <div><div class="label">Custodian</div><input id="fCust" class="input" placeholder="e.g., Apex Bank Luxembourg"/></div>
    </div>
    <hr class="sep"/>
    <div class="row">
      <button class="btn primary" id="saveLaunchBtn">Save Launch</button>
      <button class="btn ghost" id="markLaunchedBtn">Mark Launched</button>
      <div class="right small muted">ID: <span id="fId">—</span> • Last saved <span id="fSaved">—</span></div>
    </div>
  </div>

  <div class="section">
    <h3>Policy Requirements</h3>
    <div class="small muted">What evidence & approvals are required based on rules?</div>
    <table class="table">
      <thead><tr><th>Requirement</th><th>Owner</th><th>Status</th><th>Due</th></tr></thead>
      <tbody id="policyReq">
        <tr><td>Product Risk Assessment</td><td>Product</td><td><span class="badge task">Pending</span></td><td>3d</td></tr>
        <tr><td>Target Market Definition</td><td>Distribution</td><td><span class="badge ok">Complete</span></td><td>—</td></tr>
        <tr><td>Cross-border Distribution Check</td><td>Legal</td><td><span class="badge task">Pending</span></td><td>2d</td></tr>
        <tr><td>Service Provider Screening</td><td>Compliance</td><td><span class="badge task">In Progress</span></td><td>1d</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="grid-2">
  <div class="section">
    <h3>Distributor Readiness</h3>
    <div class="row small"><input type="checkbox" id="lic" /> <label for="lic">Licensing verified</label></div>
    <div class="row small"><input type="checkbox" id="tgt" /> <label for="tgt">Target market attestations received</label></div>
    <div class="row small"><input type="checkbox" id="train" /> <label for="train">Training & remuneration disclosures</label></div>
    <div class="row small"><input type="checkbox" id="agr" /> <label for="agr">Distribution agreements signed</label></div>
  </div>

  <div class="section">
    <h3>ESG Data Pack</h3>
    <div class="row small"><span class="badge info">SFDR</span> <span id="sfdrLabel">Article 6</span></div>
    <div class="row small space-top"><div style="width:170px">PAI Completeness</div><div class="progress" style="flex:1"><span id="paiProg" data-value="45"></span></div></div>
    <div class="row small space-top"><div style="width:170px">Controversy Coverage</div><div class="progress" style="flex:1"><span data-value="72"></span></div></div>
    <div class="row space-top">
      <button class="btn">Generate EET</button>
      <button class="btn ghost">Generate EMT/EPT</button>
    </div>
  </div>
</div>

      </section>
    </main>
  </div>
  <script>
  (() => {
    // Activate nav
    document.querySelectorAll('.nav a').forEach(a => { if (a.dataset.nav === 'fund-launch') a.classList.add('active'); });
  })();
  </script>
  <script>
(() => {
  const $ = (sel) => document.querySelector(sel);
  const fmtTS = (ts) => ts ? new Date(ts).toLocaleString() : '—';
  const FL_KEY = 'kyc_fund_launches';

  // SFDR dynamic bits (from earlier)
  const sel = document.getElementById('sfdrSel');
  const lab = document.getElementById('sfdrLabel');
  const pai = document.getElementById('paiProg');
  const req = document.getElementById('policyReq');
  const updateSFDR = () => {
    const v = sel.value;
    lab.textContent = v;
    let pct = 45;
    let extra = '';
    if (v === 'Article 8') { pct = 72; extra = '<tr><td>ESG Disclosures (Art. 8)</td><td>ESG</td><td><span class="badge task">Pending</span></td><td>4d</td></tr>'; }
    if (v === 'Article 9') { pct = 88; extra = '<tr><td>ESG Disclosures (Art. 9)</td><td>ESG</td><td><span class="badge task">In Progress</span></td><td>2d</td></tr>'; }
    pai.setAttribute('data-value', pct);
    const base = `
      <tr><td>Product Risk Assessment</td><td>Product</td><td><span class="badge task">Pending</span></td><td>3d</td></tr>
      <tr><td>Target Market Definition</td><td>Distribution</td><td><span class="badge ok">Complete</span></td><td>—</td></tr>
      <tr><td>Cross-border Distribution Check</td><td>Legal</td><td><span class="badge task">Pending</span></td><td>2d</td></tr>
      <tr><td>Service Provider Screening</td><td>Compliance</td><td><span class="badge task">In Progress</span></td><td>1d</td></tr>`;
    req.innerHTML = base + extra;
    requestAnimationFrame(() => { pai.style.width = '0%'; requestAnimationFrame(() => pai.style.width = pct+'%'); });
  };
  sel.addEventListener('change', updateSFDR);
  updateSFDR();

  // Fund Launch localStorage wiring
  const form = document.getElementById('launchForm');
  const idSpan = document.getElementById('fId');
  const savedSpan = document.getElementById('fSaved');
  const saveBtn = document.getElementById('saveLaunchBtn');
  const markBtn = document.getElementById('markLaunchedBtn');

  const readLaunches = () => { try { return JSON.parse(localStorage.getItem(FL_KEY) || '[]'); } catch(e){ return []; } };
  const writeLaunches = (list) => { localStorage.setItem(FL_KEY, JSON.stringify(list)); window.dispatchEvent(new StorageEvent('storage', {key:FL_KEY, newValue:JSON.stringify(list)})); };
  const nextId = (list) => {
    const max = list.reduce((m,t)=> Math.max(m, parseInt((t.id||'').split('-')[1]||'0',10)), 0);
    return `FL-${(max+1).toString().padStart(4,'0')}`;
  };
  // Compute pending reviews by counting 'task' badges and unticked distributor items
  const countPending = () => {
    let n = document.querySelectorAll('#policyReq .badge.task').length;
    ['lic','tgt','train','agr'].forEach(id => { if (!document.getElementById(id).checked) n++; });
    // Add SFDR completeness rule: < 70 => +1
    const pct = parseInt(pai.getAttribute('data-value'), 10) || 0;
    if (pct < 70) n++;
    return n;
  };
  const currentId = () => form.getAttribute('data-id') || null;

  const populateFromRecord = (r) => {
    document.getElementById('fName').value = r.name || '';
    document.getElementById('fJur').value = r.jurisdiction || 'Luxembourg';
    document.getElementById('fVeh').value = r.vehicle || 'UCITS';
    document.getElementById('sfdrSel').value = r.sfdr || 'Article 6';
    updateSFDR();
    idSpan.textContent = r.id; savedSpan.textContent = fmtTS(r.updatedAt);
    form.setAttribute('data-id', r.id);
  };

  // Load by hash if provided
  const hash = location.hash && location.hash.startsWith('#FL-') ? location.hash.slice(1) : null;
  let launches = readLaunches();
  if (!launches.length) {
    // seed some if empty (same as dashboard seeds)
    const now = new Date(); const jan = new Date(now.getFullYear(),0,15).getTime(); const mar = new Date(now.getFullYear(),2,5).getTime();
    const jul = new Date(now.getFullYear(),6,10).getTime(); const aug = new Date(now.getFullYear(),7,22).getTime();
    const thisMon = new Date(now.getFullYear(), now.getMonth(), 2).getTime();
    launches = [
      {id:'FL-0001', name:'Silver Birch UCITS', jurisdiction:'Ireland', vehicle:'UCITS', sfdr:'Article 8', stage:'launched', startDate:jan, launchedDate:mar, pendingReviews:0, updatedAt:mar},
      {id:'FL-0002', name:'Northshore Growth AIF', jurisdiction:'Luxembourg', vehicle:'AIF', sfdr:'Article 8', stage:'esg', startDate:aug, launchedDate:null, pendingReviews:3, updatedAt:Date.now()-86400000*5},
      {id:'FL-0003', name:'Sustainable Credit A', jurisdiction:'Luxembourg', vehicle:'UCITS', sfdr:'Article 9', stage:'policy', startDate:thisMon, launchedDate:null, pendingReviews:5, updatedAt:Date.now()-86400000*2},
      {id:'FL-0004', name:'Global Macro Fund', jurisdiction:'UK', vehicle:'AIF', sfdr:'Article 6', stage:'screening', startDate:jul, launchedDate:null, pendingReviews:2, updatedAt:Date.now()-86400000*9},
    ];
    writeLaunches(launches);
  }
  if (hash) {
    const rec = launches.find(x => x.id === hash);
    if (rec) populateFromRecord(rec);
  } else {
    // New launch session (not yet saved)
    idSpan.textContent = '—'; savedSpan.textContent = '—';
  }

  // Save handler
  saveBtn.addEventListener('click', () => {
    launches = readLaunches();
    const id = currentId() || nextId(launches);
    const rec = launches.find(x => x.id === id) || { id, startDate: Date.now(), stage: 'policy' };
    rec.name = document.getElementById('fName').value.trim() || 'Untitled Launch';
    rec.jurisdiction = document.getElementById('fJur').value;
    rec.vehicle = document.getElementById('fVeh').value;
    rec.sfdr = document.getElementById('sfdrSel').value;
    rec.pendingReviews = countPending();
    rec.updatedAt = Date.now();
    if (!launches.find(x => x.id === id)) launches.push(rec);
    writeLaunches(launches);
    populateFromRecord(rec);
  });

  // Mark Launched
  markBtn.addEventListener('click', () => {
    const id = currentId();
    if (!id) return alert('Save the launch first.');
    launches = readLaunches();
    const rec = launches.find(x => x.id === id);
    if (!rec) return;
    rec.stage = 'launched'; rec.launchedDate = Date.now(); rec.pendingReviews = 0; rec.updatedAt = Date.now();
    writeLaunches(launches);
    populateFromRecord(rec);
  });
})();
</script>
</body>
</html>
