<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Home Dashboard ¬∑ KYC Orchestrator</title>
<style>
:root{
--sidebar-bg: #f7fafd;
--sidebar-icon: #4976a4;
--sidebar-text: #4976a4;
--sidebar-width: 80px;
--sidebar-font-size: 12px;
--sidebar-title-size: 13px;
--sidebar-tag-size: 10px;
--sidebar-icon-size: 28px;
--sidebar-active: #e3eefa;
--sidebar-width: 170px;
--sidebar-font-size: 11px;
--sidebar-title-size: 13px;
--sidebar-tag-size: 10px;
--sidebar-icon-size: 18px;
--page:#ffffff;
--text:#0f172a;
--muted:#475569;
--line:#e5e7eb;
--card:#ffffff;
--sidebar: rgba(33,207,178,0.20);
--btn: rgba(33,207,178,0.60);
--btn-border: rgba(33,207,178,0.60);
--btn-text:#0b1220;
--link:#0ea5e9;
--task:#a399ff;
--success:#059669;
--warn:#d97706;
--danger:#dc2626;
--info:#2563eb;
--progress:#21cfb2;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; background: var(--page); color:var(--text); line-height:1.45;}
a{color:var(--link); text-decoration:none} a:hover{text-decoration:underline}

.app{display:grid; grid-template-columns: var(--sidebar-width) 1fr; min-height:100vh}
.sidebar {
background: var(--sidebar-bg);
border-right: 1px solid var(--line);
width: var(--sidebar-width);
min-width: var(--sidebar-width);
max-width: var(--sidebar-width);
display: flex;
flex-direction: column;
align-items: center;
justify-content: flex-start;
height: 100vh;
padding: 0;
}
.sidebar .brand {
display: flex;
flex-direction: column;
align-items: center;
margin: 24px 0 0 0;
}
.sidebar .logo {
width: 36px;
height: 36px;
border-radius: 12px;
background: radial-gradient(circle at 25% 20%, #4976a4 0%, #e3eefa 100%);
margin-bottom: 8px;
}
.sidebar .brand h1 {
font-size: 14px;
color: var(--sidebar-text);
margin: 0;
font-weight: 600;
letter-spacing: 0.2px;
}
.sidebar .nav {
display: flex;
flex-direction: column;
align-items: center;
gap: 28px;
margin-top: 24px;
}
.sidebar .nav a {
display: flex;
flex-direction: column;
align-items: center;
gap: 4px;
color: var(--sidebar-text);
text-decoration: none;
font-size: var(--sidebar-font-size);
padding: 0;
border-radius: 8px;
width: 100%;
transition: background 0.15s;
}
.sidebar .nav a.active, .sidebar .nav a:hover {
background: var(--sidebar-active);
}
.sidebar .nav .icon {
width: var(--sidebar-icon-size);
height: var(--sidebar-icon-size);
color: var(--sidebar-icon);
display: block;
}
.sidebar .nav .text {
font-size: var(--sidebar-font-size);
color: var(--sidebar-text);
text-align: center;
margin-top: 2px;
}
.sidebar .nav .tag {
display: none;
}
.sidebar .footer-note {
margin-top: 10px;
font-size: 10px;
color: var(--muted);
opacity: .85;
padding: 0 3px;
margin-bottom: 18px;
}
.header{display:flex; align-items:center; justify-content:space-between; padding:16px 22px; position:sticky; top:0; z-index:5; background:rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-bottom: 1px solid var(--line);}
.search{display:flex; align-items:center; gap:8px; border:1px solid var(--line); background: var(--card); padding:10px 12px; border-radius:12px; width:52%;}
.search input{flex:1; background:transparent; border:none; outline:none; color:var(--text);}
.actions{display:flex; align-items:center; gap:10px; margin-left:auto;}
.btn{background: var(--btn); border:1px solid var(--btn-border); color:var(--btn-text); padding:10px 12px; border-radius:10px; cursor:pointer; transition: filter .15s ease, transform .02s ease;}
.btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)} .btn.primary{background: var(--btn); border-color: var(--btn-border)} .btn.ghost{background:transparent; color: var(--btn-text); border-color: var(--btn-border)} .btn.small{padding:6px 10px; font-size:12px}
.kbd{font: 12px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas; padding:2px 6px; border-radius:6px; border:1px solid var(--line); color:var(--muted)}
.content{padding:14px 22px 40px}
.page-title{display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin:12px 0 8px 0}
.page-title h2{margin:0; font-size:22px}
.page-title .sub{color:var(--muted)}
.cards{display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:14px; margin:14px 0 6px}
.card{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:12px 14px; min-height:72px; box-shadow: 0 8px 28px rgba(2,6,23,.06); position:relative; transition: transform 0.2s ease, box-shadow 0.2s ease;}
.card[draggable="true"]{cursor:move; user-select:none; touch-action:none;}
.card[draggable="true"]:hover{transform:translateY(-2px); box-shadow: 0 12px 32px rgba(2,6,23,.12)}
.card[draggable="true"]:active{transform:scale(0.98)}
.card.dragging{opacity:0.5; transform:scale(0.95)}
.card.drag-over{border:2px dashed var(--progress); background:rgba(33,207,178,0.05)}
.card .label{color:var(--muted); font-size:12px} .card .value{font-size:22px; margin-top:2px} .card .trend{font-size:12px; color:#047857} .card .danger{color:var(--danger)}
.grid-2{display:grid; grid-template-columns: 2fr 1fr; gap:16px; margin-top:16px} .grid-3{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-top:16px}
.section{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:16px} .section h3{margin:0 0 10px 0; font-size:16px}
.table{width:100%; border-collapse:separate; border-spacing:0 8px; font-size:14px}
.table th{color:var(--muted); text-align:left; font-weight:600; padding:8px 10px; border-bottom:1px solid var(--line); position:relative;}
.table th.sortable{cursor:pointer; user-select:none; padding-right:24px;}
.table th.sortable:hover{color:var(--text); background:rgba(33,207,178,0.05)}
.table th.sortable::after{content:'‚áÖ'; position:absolute; right:8px; opacity:0.3; font-size:12px;}
.table th.sortable.asc::after{content:'‚Üë'; opacity:1; color:var(--progress)}
.table th.sortable.desc::after{content:'‚Üì'; opacity:1; color:var(--progress)}
.table td{padding:10px; background:#ffffff; border:1px solid var(--line)}
.table tr td:first-child{border-top-left-radius:10px; border-bottom-left-radius:10px} .table tr td:last-child{border-top-right-radius:10px; border-bottom-right-radius:10px}
.table-controls{display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap:wrap;}
.table-search{flex:1; min-width:200px; max-width:320px; display:flex; align-items:center; gap:8px; border:1px solid var(--line); background:var(--card); padding:8px 10px; border-radius:8px;}
.table-search input{flex:1; background:transparent; border:none; outline:none; color:var(--text); font-size:13px;}
.table-search svg{width:16px; height:16px; color:var(--muted);}
.table-pagination{display:flex; gap:6px; align-items:center; margin-top:12px; font-size:13px;}
.table-pagination button{background:var(--card); border:1px solid var(--line); color:var(--text); padding:6px 10px; border-radius:6px; cursor:pointer; transition:all 0.15s;}
.table-pagination button:hover:not(:disabled){background:rgba(33,207,178,0.1); border-color:var(--progress)}
.table-pagination button:disabled{opacity:0.4; cursor:not-allowed;}
.table-pagination .page-info{color:var(--muted); margin:0 8px;}
.export-buttons{display:flex; gap:6px; margin-left:auto;}
.export-buttons button{background:var(--card); border:1px solid var(--line); color:var(--text); padding:6px 10px; border-radius:6px; cursor:pointer; font-size:12px; transition:all 0.15s; display:flex; align-items:center; gap:6px;}
.export-buttons button:hover{background:rgba(33,207,178,0.1); border-color:var(--progress)}
.export-buttons svg{width:14px; height:14px;}
.toast-container{position:fixed; top:80px; right:20px; z-index:9999; display:flex; flex-direction:column; gap:10px; pointer-events:none;}
.toast{background:var(--card); border:1px solid var(--line); border-radius:10px; padding:12px 16px; box-shadow:0 8px 24px rgba(0,0,0,0.15); min-width:280px; max-width:400px; pointer-events:auto; animation:slideInRight 0.3s ease; display:flex; align-items:center; gap:10px;}
.toast.success{border-left:4px solid var(--success); background:rgba(5,150,105,0.05)}
.toast.info{border-left:4px solid var(--info); background:rgba(37,99,235,0.05)}
.toast.warn{border-left:4px solid var(--warn); background:rgba(217,119,6,0.05)}
.toast.error{border-left:4px solid var(--danger); background:rgba(220,38,38,0.05)}
.toast-icon{font-size:20px; flex-shrink:0;}
.toast-content{flex:1;}
.toast-title{font-weight:600; font-size:13px; margin-bottom:2px;}
.toast-message{font-size:12px; color:var(--muted)}
.toast-close{cursor:pointer; opacity:0.6; font-size:18px; padding:0 4px; transition:opacity 0.15s;}
.toast-close:hover{opacity:1}
@keyframes slideInRight{from{transform:translateX(100%); opacity:0}to{transform:translateX(0); opacity:1}}
.update-indicator{display:inline-flex; align-items:center; gap:6px; padding:4px 10px; background:rgba(33,207,178,0.1); border:1px solid rgba(33,207,178,0.3); border-radius:6px; font-size:12px; color:var(--progress); animation:pulse 2s ease infinite;}
.update-indicator::before{content:''; width:8px; height:8px; background:var(--progress); border-radius:50%; animation:blink 1.5s ease infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
.badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; color:#0b1220}
.badge.ok{border-color:#065f46; background:#ecfdf5; color:#065f46} .badge.warn{border-color:#92400e; background:#fffbeb; color:#92400e}
.badge.danger{border-color:#7f1d1d; background:#fef2f2; color:#7f1d1d} .badge.info{border-color:#1e3a8a; background:#eff6ff; color:#1e3a8a} .badge.task{border-color:#6f63ff; background:#a399ff; color:#ffffff}
.pills{display:flex; gap:8px; flex-wrap:wrap}
.pill{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; cursor:pointer; font-size:12px; color:#0b1220}
.pill.active{background:rgba(33,207,178,0.18); border-color:rgba(33,207,178,0.28)}
.progress{width:100%; height:10px; border-radius:999px; background:#f1f5f9; border:1px solid var(--line); overflow:hidden}
.progress > span{display:block; height:100%; background:linear-gradient(90deg, var(--progress), rgba(33,207,178,0.85)); width:0%}
.stepper{display:flex; gap:10px; flex-wrap:wrap}
.step{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; border:1px dashed #94a3b8; background:#f8fafc; color:#0b1220}
.step.current{border-style:solid; background:rgba(33,207,178,0.10)} .step .dot{width:10px; height:10px; border-radius:50%; background:#94a3b8; border:2px solid #cbd5e1}
.step.done .dot{background:#059669; border-color:#059669} .step.current .dot{background:var(--progress)}
.form-grid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px}
.label{font-size:12px; color:var(--muted); margin-bottom:6px}
.input, select, textarea{width:100%; background:#ffffff; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px 12px}
.row{display:flex; gap:10px; align-items:center} hr.sep{border:0; border-top:1px solid var(--line); margin:14px 0}
.right{margin-left:auto} .muted{color:var(--muted)} .small{font-size:12px} .space-top{margin-top:10px} .center{display:flex; align-items:center; justify-content:center} .hidden{display:none!important}
/* Collapsible tracker */
.tracker .head{display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none}
.chev{width:12px; height:12px; border-right:2px solid #334155; border-bottom:2px solid #334155; transform:rotate(45deg); transition: transform .15s ease;}
.tracker.collapsed .chev{transform:rotate(-135deg)}
.tracker .meta{display:flex; gap:12px; flex-wrap:wrap; margin-left:auto}
.stat{display:flex; gap:6px; align-items:center; font-size:12px; border:1px solid var(--line); border-radius:999px; padding:4px 8px; background:#f8fafc}
.stat b{font-weight:700}
.tracker-body{margin-top:10px}
/* Modal */
.modal{position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:999}
.modal .box{background:#fff; border-radius:12px; border:1px solid var(--line); width:min(460px, 95vw); max-height:calc(100vh - 120px); overflow:auto; padding:16px; box-shadow:0 20px 60px rgba(0,0,0,.25)}
.modal .box h4{margin:0 0 8px 0}
.modal .box .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
/* Floating Chat Button */
.floating-chat-btn{position:fixed; bottom:24px; right:24px; background:linear-gradient(135deg, var(--btn), rgba(33,207,178,0.85)); color:var(--btn-text); border:1px solid var(--btn-border); padding:14px 20px; border-radius:50px; font-size:15px; font-weight:600; cursor:pointer; box-shadow:0 8px 24px rgba(33,207,178,0.35); transition:all 0.3s ease; z-index:100; display:flex; align-items:center; gap:8px;}
.floating-chat-btn:hover{transform:translateY(-2px); box-shadow:0 12px 32px rgba(33,207,178,0.45); filter:brightness(1.08)}
.floating-chat-btn:active{transform:translateY(0)}
.floating-chat-btn svg{width:20px; height:20px}
/* Chat Modal (resized to match FundBot chat card dimensions) */
.chat-modal .box{width:min(460px, 95vw); max-height:calc(100vh - 120px); padding:0; background:#0b1020; overflow:hidden; border-radius:18px}
/* Mini timeline */
.timeline{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px}
.tl-step{display:flex; flex-direction:column; align-items:center; gap:4px; min-width:90px}
.tl-dot{width:10px; height:10px; border-radius:50%; background:#e2e8f0; border:2px solid #cbd5e1}
.tl-step.done .tl-dot{background:#059669; border-color:#059669}
.tl-step.pending .tl-dot{background:#e2e8f0}
.tl-label{font-size:12px; color:#0f172a}
.tl-time{font-size:11px; color:#475569}
.tl-line{width:28px; height:2px; background:#cbd5e1}
.timeline .tl-step.pending .tl-label{opacity:0.7}

/* ===== MODERN RESPONSIVE ENHANCEMENTS ===== */

/* Mobile Hamburger Menu */
.mobile-menu-btn {
  display: none;
  position: fixed;
  top: 16px;
  left: 16px;
  z-index: 1101;
  background: var(--btn);
  border: 1px solid var(--btn-border);
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(33,207,178,0.2);
  transition: all 0.2s ease;
}
.mobile-menu-btn:hover { filter: brightness(1.05); }
.mobile-menu-btn:active { transform: scale(0.96); }
.mobile-menu-btn svg { width: 24px; height: 24px; display: block; }

/* Off-Canvas Sidebar */
@media (max-width: 768px) {
  .mobile-menu-btn { display: block; }
  
  .sidebar {
    position: fixed;
    left: -100%;
    top: 0;
    height: 100vh;
    width: 280px;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1100;
    box-shadow: 4px 0 16px rgba(0,0,0,0.15);
    overflow-y: auto;
  }
  
  body.nav-open .sidebar { left: 0; }
  
  /* Backdrop overlay */
  body.nav-open::after {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1099;
    backdrop-filter: blur(3px);
    animation: fadeIn 0.3s ease;
  }
  
  .app { grid-template-columns: 1fr; }
  .main { width: 100%; }
  .header { padding-top: 60px; } /* space for hamburger */
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Table Responsive Wrappers */
.table-wrapper {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  margin: 0 -16px;
  padding: 0 16px;
  border-radius: 12px;
}

@media (max-width: 768px) {
  .table {
    font-size: 12px;
    min-width: 600px;
  }
  
  .table th,
  .table td {
    padding: 8px 6px;
    white-space: nowrap;
  }
  
  /* Sticky first column for context */
  .table thead th:first-child,
  .table tbody td:first-child {
    position: sticky;
    left: 0;
    background: var(--card);
    z-index: 2;
    box-shadow: 2px 0 4px rgba(0,0,0,0.08);
  }
}

/* Adaptive Card Grid */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 14px;
  margin: 14px 0 6px;
}

@media (max-width: 1200px) {
  .cards { grid-template-columns: repeat(3, 1fr); }
}

@media (max-width: 768px) {
  .cards { grid-template-columns: repeat(2, 1fr); gap: 12px; }
}

@media (max-width: 640px) {
  .cards { 
    grid-template-columns: repeat(2, 1fr); 
    gap: 10px;
  }
  .card { 
    min-height: 70px; 
    padding: 10px 12px; 
  }
  .card .label { font-size: 11px; }
  .card .value { font-size: 18px; }
  .card .trend { font-size: 11px; }
}

@media (max-width: 480px) {
  .cards { 
    grid-template-columns: repeat(2, 1fr); 
    gap: 8px;
  }
  .card { 
    min-height: 65px; 
    padding: 8px 10px; 
  }
  .card .label { font-size: 10px; line-height: 1.3; }
  .card .value { font-size: 16px; margin-top: 4px; }
  .card .trend { font-size: 10px; }
}

@media (max-width: 360px) {
  .cards { 
    grid-template-columns: repeat(2, 1fr); 
    gap: 6px;
  }
  .card { 
    min-height: 60px; 
    padding: 6px 8px; 
  }
  .card .label { font-size: 9px; line-height: 1.2; }
  .card .value { font-size: 15px; }
  .card .trend { font-size: 9px; }
}

/* Header Reflow for Mobile */
@media (max-width: 768px) {
  .header {
    flex-wrap: wrap;
    padding: 12px 16px 12px 60px; /* left space for hamburger */
    gap: 10px;
  }
  
  .header > div {
    width: 100%;
    flex-wrap: wrap;
  }
  
  .search {
    width: 100% !important;
    max-width: 100% !important;
    order: 2;
    margin-top: 8px;
    margin-left: 0 !important;
  }
  
  .actions {
    order: 1;
    margin-left: auto !important;
    gap: 8px;
  }
  
  .actions .btn {
    padding: 9px 12px;
    font-size: 13px;
  }
  
  .btn.ghost {
    padding: 9px 10px;
  }
  
  .btn.ghost::after {
    content: '+';
    font-size: 18px;
    font-weight: 600;
  }
}

@media (max-width: 480px) {
  .btn span { display: none; }
  
  .page-title h2 { font-size: 18px; }
  .page-title .sub { font-size: 11px; }
  
  .content { padding: 10px 12px 30px; }
  
  .section { padding: 12px; }
  .section h3 { font-size: 14px; margin-bottom: 8px; }
}

/* Responsive Grid Adjustments */
@media (max-width: 768px) {
  .grid-2,
  .grid-3 {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .content {
    padding: 12px 16px 40px;
  }
  
  .page-title {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }
  
  .page-title h2 {
    font-size: 20px;
  }
  
  .tracker .meta {
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
  }
  
  .stat {
    font-size: 11px;
    padding: 3px 6px;
  }
}

/* Dark Mode Theme */
.theme-toggle {
  background: transparent;
  border: 1px solid var(--line);
  color: var(--text);
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 40px;
}
.theme-toggle:hover { background: var(--sidebar-active); }

body.dark-theme {
  --page: #0f172a;
  --text: #f1f5f9;
  --muted: #94a3b8;
  --line: rgba(33,207,178,0.2);
  --card: #1e293b;
  --sidebar-bg: #1e293b;
  --sidebar-text: #cbd5e1;
  --sidebar-icon: #21cfb2;
  --sidebar-active: rgba(33,207,178,0.15);
  --btn: rgba(33,207,178,0.6);
  --btn-border: rgba(33,207,178,0.6);
  --btn-text: #f1f5f9;
  --task: #a399ff;
  --link: #21cfb2;
  --progress: #21cfb2;
}

body.dark-theme .table td {
  background: #334155;
  border-color: rgba(33,207,178,0.15);
}

body.dark-theme .header {
  background: rgba(30,41,59,0.95);
  border-bottom-color: rgba(33,207,178,0.2);
}

body.dark-theme .search,
body.dark-theme .input,
body.dark-theme select,
body.dark-theme textarea {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
  color: var(--text);
}

body.dark-theme .badge {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
  color: #cbd5e1;
}

body.dark-theme .badge.ok {
  background: rgba(5,150,105,0.2);
  border-color: #059669;
  color: #6ee7b7;
}

body.dark-theme .badge.warn {
  background: rgba(217,119,6,0.2);
  border-color: #d97706;
  color: #fbbf24;
}

body.dark-theme .badge.danger {
  background: rgba(220,38,38,0.2);
  border-color: #dc2626;
  color: #fca5a5;
}

body.dark-theme .badge.info {
  background: rgba(37,99,235,0.2);
  border-color: #2563eb;
  color: #93c5fd;
}

body.dark-theme .badge.task {
  background: rgba(163,153,255,0.25);
  border-color: #a399ff;
  color: #e0dbff;
}

body.dark-theme .pill {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
  color: #cbd5e1;
}

body.dark-theme .pill.active {
  background: rgba(33,207,178,0.2);
  border-color: rgba(33,207,178,0.4);
  color: #21cfb2;
}

body.dark-theme .progress {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
}

body.dark-theme .step {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
  color: #cbd5e1;
}

body.dark-theme .step.current {
  background: rgba(33,207,178,0.15);
  border-color: #21cfb2;
}

body.dark-theme .stat {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
}

body.dark-theme .modal {
  background: rgba(0,0,0,0.6);
}

body.dark-theme .modal .box {
  background: #1e293b;
  border-color: rgba(33,207,178,0.2);
}

body.dark-theme .floating-chat-btn {
  box-shadow: 0 8px 24px rgba(33,207,178,0.4);
}

body.dark-theme .chat-modal .box {
  background: #0f172a;
  border-color: rgba(33,207,178,0.3);
}

body.dark-theme .table-search,
body.dark-theme .table-pagination button {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
}

body.dark-theme .table-pagination button:hover:not(:disabled) {
  background: rgba(33,207,178,0.15);
  border-color: #21cfb2;
}

body.dark-theme .table th.sortable:hover {
  background: rgba(33,207,178,0.1);
}

body.dark-theme .export-buttons button {
  background: #334155;
  border-color: rgba(33,207,178,0.2);
}

body.dark-theme .export-buttons button:hover {
  background: rgba(33,207,178,0.15);
  border-color: #21cfb2;
}

body.dark-theme .toast {
  background: #1e293b;
  border-color: rgba(33,207,178,0.2);
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
}

body.dark-theme .card.drag-over {
  border-color: #21cfb2;
  background: rgba(33,207,178,0.1);
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== TABLET-SPECIFIC OPTIMIZATIONS ===== */
@media (min-width: 768px) and (max-width: 1024px) {
  /* Touch-friendly tap targets (minimum 44x44px) */
  .btn,
  .pill,
  .badge,
  button,
  a {
    min-height: 44px;
    min-width: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .btn span {
    display: inline;
  }
  
  /* Optimized 2-column layouts for tablet */
  .grid-2 {
    grid-template-columns: 1fr;
    gap: 14px;
  }
  
  .cards {
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  
  /* Larger text for readability */
  body {
    font-size: 15px;
  }
  
  .table {
    font-size: 13px;
  }
  
  /* Increased padding for touch */
  .section {
    padding: 20px;
  }
  
  .content {
    padding: 16px 20px 40px;
  }
  
  /* Collapsible sections auto-collapsed on tablet */
  .tracker .head {
    padding: 12px;
    background: rgba(33,207,178,0.05);
    border-radius: 8px;
    margin-bottom: 8px;
  }
  
  /* Optimize search bar sizing */
  .search {
    min-width: 240px;
  }
  
  .table-search {
    min-width: 180px;
  }
}

/* Legacy breakpoints (keep for compatibility) */
@media (max-width:1100px){ .app{grid-template-columns: 80px 1fr} .brand h1, .footer-note, .nav a .text, .nav a .tag{display:none} .nav a{justify-content:center} }
@media (min-width:769px) and (max-width:1100px) { .search{width:70%} }

</style>
</head>
<body data-page="dashboard">
<a href="#main" class="kbd" style="position:absolute; left:-9999px; top:-9999px">Skip to content</a>

<!-- Toast Notification Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Mobile Hamburger Menu -->
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation menu" aria-expanded="false">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</button>

<div class="app">

<aside class="sidebar" aria-label="Sidebar Navigation">
<div class="brand">
<img src="Designer.png" alt="Logo" style="height:45px; width:auto; object-fit:contain; border-radius:12px; margin-bottom:8px;" />
<h1>KYC Orchestrator</h1>
</div>
<nav class="nav">
<a href="index.html" data-nav="dashboard" aria-label="Dashboard">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12l9-9 9 9" stroke="#0b1220" stroke-width="1.5"/><path d="M5 10v10h5v-6h4v6h5V10" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Dashboard</span>
</a>
<a href="fund-launch.html" data-nav="fund-launch" aria-label="Fund Launch">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 19h16M7 19V7a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v12" stroke="#0b1220" stroke-width="1.5"/><path d="M9 9h6m-6 4h6" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Fund Launch</span>
<span class="tag">Product</span>
</a>
<a href="distributor-onboarding.html" data-nav="distributor" aria-label="Distributor Onboarding">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 8h10a4 4 0 0 1 4 4v6H3v-6a4 4 0 0 1 4-4z" stroke="#0b1220" stroke-width="1.5"/><path d="M7 8V6a5 5 0 0 1 10 0v2" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Distributor Onboarding</span>
<span class="tag">KYD</span>
</a>
<a href="investor-onboarding.html" data-nav="investor" aria-label="Investor Onboarding">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5z" stroke="#0b1220" stroke-width="1.5"/><path d="M3 21a9 9 0 0 1 18 0" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Investor Onboarding</span>
<span class="tag">KYC/KYB</span>
</a>
<a href="Entity-mgmt.html" data-nav="entity" aria-label="Entity Management">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="3" stroke="#0b1220" stroke-width="1.5"/><path d="M8 12h8M8 16h8" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Entity Management</span>
</a>
<a href="asset-dd.html" data-nav="asset" aria-label="Asset & Vehicle Due Diligence">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 7h18M3 12h18M3 17h18" stroke="#0b1220" stroke-width="1.5"/><path d="M8 7v12m8-12v12" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Asset & Vehicle DD</span>
<span class="tag">KYI</span>
</a>
<a href="monitoring.html" data-nav="monitoring" aria-label="Monitoring & Screening">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 13l4 4 12-12" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Monitoring & Screening</span>
<span class="tag">KYT</span>
</a>
<a href="digital-trading.html" data-nav="digital" aria-label="Digital Trading">
<svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16v12H4z" stroke="#0b1220" stroke-width="1.5"/><path d="M8 10h8M8 14h5" stroke="#0b1220" stroke-width="1.5"/></svg>
<span class="text">Digital Trading</span>
<span class="tag">Trades</span>
</a>
</nav>
<div class="footer-note">Prototype ‚Ä¢ Static HTML ‚Ä¢ Local storage</div>
</aside>

<main class="main">
<header class="header" role="banner">
<div style="display:flex; align-items:center; justify-content:space-between;">
<div class="search" role="search" aria-label="Search" style="width:52%; min-width:260px; max-width:480px;">
<input placeholder="Search parties, products, accounts, cases‚Ä¶ (press / to focus)" aria-label="Global search"/>
<span class="kbd">/</span>
</div>
<div class="actions" style="display:flex; gap:10px; margin-left:auto;">
<button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark mode">üåô</button>
<button class="btn ghost" aria-label="New case"><span>New Case</span></button>
<button class="btn primary" aria-label="Add party"><span>+ Add Party</span></button>
</div>
</div>
</header>
<section class="content" id="main">
<div class="page-title">
<h2>Home Dashboard</h2>
<div class="sub">Unified CLM ‚Ä¢ KYC/KYB/KYD/KYI/KYT ‚Ä¢ Digital Trading</div>
</div>

<div class="cards" aria-label="KPI cards" id="kpiCards">
<div class="card" draggable="true" data-card-id="1"><div class="label">Median Time-to-KYC</div><div class="value">2.4 days</div><div class="trend">-12% WoW</div></div>
<div class="card" draggable="true" data-card-id="2"><div class="label">Open Cases</div><div class="value">128</div><div class="trend">+5 today</div></div>
<div class="card" draggable="true" data-card-id="3"><div class="label">High-Risk Parties</div><div class="value danger">17</div><div class="trend">3 require EDD</div></div>
<div class="card" draggable="true" data-card-id="4"><div class="="label">Pending Approvals</div><div class="value">34</div><div class="trend">11 overdue</div></div>
<div class="card" draggable="true" data-card-id="5"><div class="label">Screening Hits (24h)</div><div class="value">58</div><div class="trend">FPR 7.1%</div></div>
<div class="card" draggable="true" data-card-id="6"><div class="label">Open Digital Trades</div><div class="value" id="openTrades">0</div><div class="trend"><span id="investedCount">0</span> invested</div></div>
</div>

<div class="grid-2">
<div class="section" aria-label="Work Queue">
<h3>My Work Queue</h3>
<div class="table-controls">
<div class="table-search">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
<input type="text" id="queueSearch" placeholder="Search cases..." aria-label="Search work queue"/>
</div>
<div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
<span class="small muted">Showing <b id="queueCount">5</b> of <b id="queueTotal">5</b></span>
<div class="export-buttons">
<button id="exportQueueCSV" title="Export to CSV" aria-label="Export to CSV">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
CSV
</button>
<button id="exportQueuePDF" title="Export to PDF" aria-label="Export to PDF">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
PDF
</button>
</div>
</div>
</div>
<div class="table-wrapper">
<table class="table" role="table" id="queueTable">
<thead><tr>
<th class="sortable" data-sort="id">Case ID</th>
<th class="sortable" data-sort="type">Type</th>
<th class="sortable" data-sort="party">Party / Product</th>
<th class="sortable" data-sort="risk">Risk</th>
<th class="sortable" data-sort="age">Age</th>
<th class="sortable" data-sort="owner">Owner</th>
<th class="sortable" data-sort="status">Status</th>
</tr></thead>
<tbody>
<tr data-risk="high" data-age="2"><td>#CA-10482</td><td>Investor KYC</td><td>Riverton Capital SICAV</td><td><span class="badge danger">High</span></td><td>2d</td><td>J. Han</td><td><span class="badge task">Docs requested</span></td></tr>
<tr data-risk="medium" data-age="0"><td>#CA-10479</td><td>Distributor KYD</td><td>Alpha Distrib GmbH</td><td><span class="badge warn">Medium</span></td><td>5h</td><td>M. Rossi</td><td><span class="badge ok">Screened</span></td></tr>
<tr data-risk="medium" data-age="1"><td>#CA-10463</td><td>Fund Launch</td><td>Northshore Growth AIF</td><td><span class="badge warn">Medium</span></td><td>1d</td><td>S. Patel</td><td><span class="badge task">Awaiting ESG pack</span></td></tr>
<tr data-risk="low" data-age="0"><td>#CA-10451</td><td>Asset DD</td><td>ISIN LU1234567890</td><td><span class="badge">Low</span></td><td>7h</td><td>L. Chen</td><td><span class="badge task">Checks passing</span></td></tr>
<tr data-risk="high" data-age="0"><td>#CA-10437</td><td>Monitoring</td><td>Txn T-998210</td><td><span class="badge danger">High</span></td><td>3h</td><td>Team KYT</td><td><span class="badge task">Escalated</span></td></tr>
</tbody>
</table>
</div>
<div class="table-pagination" id="queuePagination" style="display:none;">
<button id="queuePrevPage" aria-label="Previous page">‚Üê Prev</button>
<span class="page-info">Page <b id="queueCurrentPage">1</b> of <b id="queueTotalPages">1</b></span>
<button id="queueNextPage" aria-label="Next page">Next ‚Üí</button>
</div>
</div>
<div class="section">
<h3>Upcoming Reviews</h3>
<div class="row"><span class="badge warn">Due in 3d</span> Blue Cove Partners LLP ‚Ä¢ Institutional ‚Ä¢ <span class="muted">Periodic review (36m)</span></div>
<div class="row space-top"><span class="badge">Due in 7d</span> Arcturus Family Office ‚Ä¢ HNW ‚Ä¢ <span class="muted">UBO refresh</span></div>
<div class="row space-top"><span class="badge">Due in 9d</span> Solaris Bank AG ‚Ä¢ Distributor ‚Ä¢ <span class="muted">KYD re-attestation</span></div>
<hr class="sep"/>
<h3>Compliance Health</h3>
<div class="row small"><div style="width:140px">Sanctions coverage</div><div class="progress" style="flex:1"><span data-value="100"></span></div></div>
<div class="row small space-top"><div style="width:140px">PEP coverage</div><div class="progress" style="flex:1"><span data-value="100"></span></div></div>
<div class="row small space-top"><div style="width:140px">Adverse media</div><div class="progress" style="flex:1"><span data-value="84"></span></div></div>
<div class="row small space-top"><div style="width:140px">ESG data</div><div class="progress" style="flex:1"><span data-value="74"></span></div></div>
</div>
</div>

<div class="grid-2">
<!-- Fund Launches Tracker -->
<div class="section tracker" id="fundTracker">
<div class="head" id="fundHead">
<div class="chev" aria-hidden="true"></div>
<h3>Fund Launches Tracker</h3>
<div class="meta">
<span class="stat"><span class="muted">Active</span> <b id="flActiveYTD">0</b> YTD ‚Ä¢ <b id="flActiveMTD">0</b> MTD</span>
<span class="stat"><span class="muted">Completed</span> <b id="flDoneYTD">0</b> YTD ‚Ä¢ <b id="flDoneMTD">0</b> MTD</span>
<span class="stat"><span class="muted">Avg time to launch</span> <b id="flAvgYTD">‚Äî</b> YTD ‚Ä¢ <b id="flAvgMTD">‚Äî</b> MTD</span>
<span class="stat"><span class="muted">Pending reviews</span> <b id="flPendYTD">0</b> YTD ‚Ä¢ <b id="flPendMTD">0</b> MTD</span>
</div>
</div>
<div class="tracker-body" id="fundBody">
<div class="table-controls">
<div class="table-search">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
<input type="text" id="fundSearch" placeholder="Search launches..." aria-label="Search fund launches"/>
</div>
</div>
<div class="table-wrapper">
<table class="table" id="fundTable">
<thead><tr>
<th class="sortable" data-sort="id">ID</th>
<th class="sortable" data-sort="name">Name</th>
<th class="sortable" data-sort="stage">Stage</th>
<th class="sortable" data-sort="jurisdiction">Jurisdiction</th>
<th class="sortable" data-sort="vehicle">Vehicle</th>
<th class="sortable" data-sort="pending">Pending</th>
<th class="sortable" data-sort="days">Days since start</th>
<th class="sortable" data-sort="updated">Updated</th>
</tr></thead>
<tbody></tbody>
</table>
</div>
<div class="small muted">Click a row to view details, or open <a href="fund-launch.html">Fund Launch</a> to edit/create.</div>
</div>
</div>

<!-- Digital Trades Tracker -->
<div class="section tracker" id="tradeTracker">
<div class="head" id="tradeHead">
<div class="chev" aria-hidden="true"></div>
<h3>Digital Trades Tracker</h3>
<div class="meta">
<span class="stat"><span class="muted">Open</span> <b id="dtOpenYTD">0</b> YTD ‚Ä¢ <b id="dtOpenMTD">0</b> MTD</span>
<span class="stat"><span class="muted">Invested</span> <b id="dtInvYTD">0</b> YTD ‚Ä¢ <b id="dtInvMTD">0</b> MTD</span>
</div>
</div>
<div class="tracker-body" id="tradeBody">
<div class="table-controls">
<div class="table-search">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
<input type="text" id="tradeSearch" placeholder="Search trades..." aria-label="Search digital trades"/>
</div>
</div>
<div class="table-wrapper">
<table class="table" id="tradesTracker">
<thead><tr>
<th class="sortable" data-sort="id">ID</th>
<th class="sortable" data-sort="name">Name</th>
<th class="sortable" data-sort="stage">Stage</th>
<th class="sortable" data-sort="accepted">Accepted</th>
<th class="sortable" data-sort="onboarding">Onboarding</th>
<th class="sortable" data-sort="invested">Invested</th>
<th class="sortable" data-sort="updated">Updated</th>
</tr></thead>
<tbody></tbody>
</table>
</div>
<div class="small muted">Source: local storage. Open <a href="digital-trading.html">Digital Trading</a> to add/edit trades.</div>
</div>
</div>
</div>

<!-- Modal -->
<div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Detail dialog">
<div class="box">
<h4 id="modalTitle">Details</h4>
<div id="modalBody" class="small"></div>
<div class="actions"><button class="btn" id="modalClose">Close</button></div>
</div>
</div>

<!-- Floating Chat Button -->
<button id="chatToOnboardBtn" class="floating-chat-btn" aria-label="Chat to Onboard">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
  </svg>
  Chat to Onboard
</button>

<!-- Chat Modal -->
<div id="chatModal" class="modal chat-modal hidden" role="dialog" aria-modal="true" aria-label="Chat to Onboard">
  <div class="box">
  <iframe id="chatIframe" src="fundbot_chat_prototype.html" sandbox="allow-scripts allow-same-origin" style="width:100%; height:calc(100vh - 160px); max-height:780px; border:none; border-radius:18px;"></iframe>
  </div>
</div>

</section>
</main>
</div>
<script>
(() => {
document.querySelectorAll('.nav a').forEach(a => { if (a.dataset.nav === 'dashboard') a.classList.add('active'); });
})();
</script>
<script>
(() => {
const now = new Date();
const y = now.getFullYear(), m = now.getMonth();

const fmtTS = (ts) => ts ? new Date(ts).toLocaleString() : '‚Äî';
const daysBetween = (a,b) => Math.max(0, Math.round((b - a) / 86400000));
const inYear = (ts) => new Date(ts).getFullYear() === y;
const inMonth = (ts) => { const d = new Date(ts); return d.getFullYear()===y && d.getMonth()===m; };
const mean = (arr) => arr.length ? Math.round(arr.reduce((a,b)=>a+b,0) / arr.length) : null;
const showAvg = (v) => v===null ? '‚Äî' : (v + 'd');
const $ = (sel) => document.querySelector(sel);

// Collapsible
const makeCollapsible = (headSel, bodySel, trackerSel) => {
const head = $(headSel), body = $(bodySel), wrap = $(trackerSel);
head.addEventListener('click', (e) => {
if (e.target.closest('a')) return;
body.classList.toggle('hidden'); wrap.classList.toggle('collapsed');
});
};
makeCollapsible('#fundHead','#fundBody','#fundTracker');
makeCollapsible('#tradeHead','#tradeBody','#tradeTracker');

// Modal
const modal = $('#modal'), modalTitle = $('#modalTitle'), modalBody = $('#modalBody');
const openModal = (title, html) => { modalTitle.textContent = title; modalBody.innerHTML = html; modal.classList.remove('hidden'); };
$('#modalClose').addEventListener('click', () => modal.classList.add('hidden'));
modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

// Digital Trades
const DT_KEY = 'kyc_trades';
const loadTrades = () => {
let list = [];
try { list = JSON.parse(localStorage.getItem(DT_KEY) || '[]'); } catch (e) { list = []; }
if (!list.length) {
list = [{
id:'DT-0001', name:'Seed Trade ‚Äî Sustainable Credit A', closingDate:'2025-10-31',
stage:'invite', closed:false, terms:'Sample T&Cs ...',
tags:[{name:'amount',type:'number',required:true},{name:'currency',type:'dropdown',required:true,options:'USD,EUR'}],
investors:[{email:'investor1@example.com', status:'accepted'}, {email:'investor2@example.com', status:'onboarding'}, {email:'investor3@example.com', status:'invited'}],
createdAt: Date.now()-86400000*30, updatedAt: Date.now()-3600000
}];
localStorage.setItem(DT_KEY, JSON.stringify(list));
}
return list;
};
const trades = loadTrades();
const openTrades = trades.filter(t=>!t.closed);
const investedYTD = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=> i.status==='invested' && inYear(t.updatedAt)).length, 0);
const investedMTD = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=> i.status==='invested' && inMonth(t.updatedAt)).length, 0);
const openYTD = openTrades.filter(t=> inYear(t.createdAt)).length;
const openMTD = openTrades.filter(t=> inMonth(t.createdAt)).length;
$('#openTrades').textContent = openTrades.length;
$('#investedCount').textContent = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=>i.status==='invested').length, 0);
$('#dtOpenYTD').textContent = openYTD; $('#dtOpenMTD').textContent = openMTD;
$('#dtInvYTD').textContent = investedYTD; $('#dtInvMTD').textContent = investedMTD;

const tBody = $('#tradesTracker tbody');
const badge = (stage) => {
const m = {created:'info', legal:'warn', im:'warn', blueprint:'', invite:'ok', live:'ok'};
const cls = m[stage] || ''; const label = stage ? stage[0].toUpperCase()+stage.slice(1) : '‚Äî';
return `<span class="badge ${cls}">${label}</span>`;
};
tBody.innerHTML = openTrades.map(t => {
const a = t.investors.filter(i=>i.status==='accepted').length;
const o = t.investors.filter(i=>i.status==='onboarding').length;
const v = t.investors.filter(i=>i.status==='invested').length;
return `<tr data-id="${t.id}" style="cursor:pointer" data-accepted="${a}" data-onboarding="${o}" data-invested="${v}"><td>${t.id}</td><td>${t.name||'‚Äî'}</td><td>${badge(t.stage)}</td><td>${a}</td><td>${o}</td><td>${v}</td><td>${fmtTS(t.updatedAt)}</td></tr>`;
}).join('');
tBody.querySelectorAll('tr').forEach(tr => tr.addEventListener('click', () => {
const t = openTrades.find(x => x.id === tr.getAttribute('data-id'));
if (!t) return;
const list = t.investors.map(i => `<li>${i.email} ‚Äî <b>${i.status}</b></li>`).join('');
openModal(`Digital Trade ${t.id}`, `
     <div class="row small"><div style="width:140px">Name</div><div>${t.name||'‚Äî'}</div></div>
     <div class="row small"><div style="width:140px">Stage</div><div>${t.stage}</div></div>
     <div class="row small"><div style="width:140px">Closing Date</div><div>${t.closingDate||'‚Äî'}</div></div>
     <hr class="sep"/>
     <div class="small"><b>Investors</b></div>
     <ul class="small">${list||'<li>None</li>'}</ul>
     <div class="actions"><a class="btn" href="digital-trading.html#${t.id}">Open in Digital Trading</a></div>
   `);
}));

// Fund Launches
const FL_KEY = 'kyc_fund_launches';
const seedLaunches = () => {
const now = new Date();
const jan = new Date(now.getFullYear(),0,15).getTime();
const mar = new Date(now.getFullYear(),2,5).getTime();
const jul = new Date(now.getFullYear(),6,10).getTime();
const aug = new Date(now.getFullYear(),7,22).getTime();
const thisMon = new Date(now.getFullYear(), now.getMonth(), 2).getTime();
return [
{id:'FL-0001', name:'Silver Birch UCITS', jurisdiction:'Ireland', vehicle:'UCITS', sfdr:'Article 8', stage:'launched', startDate:jan, launchedDate:mar, pendingReviews:0, updatedAt:mar, timeline:{policy:jan, kyd:jan+1000*60*60*24*14, esg:new Date(new Date(jan).getFullYear(),1,10).getTime(), screening:new Date(new Date(mar).getFullYear(),2,1).getTime(), launch:mar}},
{id:'FL-0002', name:'Northshore Growth AIF', jurisdiction:'Luxembourg', vehicle:'AIF', sfdr:'Article 8', stage:'esg', startDate:aug, launchedDate:null, pendingReviews:3, updatedAt:Date.now()-86400000*5, timeline:{policy:aug, kyd:aug+1000*60*60*24*7, esg:Date.now()-86400000*5}},
{id:'FL-0003', name:'Sustainable Credit A', jurisdiction:'Luxembourg', vehicle:'UCITS', sfdr:'Article 9', stage:'policy', startDate:thisMon, launchedDate:null, pendingReviews:5, updatedAt:Date.now()-86400000*2, timeline:{policy:thisMon}},
{id:'FL-0004', name:'Global Macro Fund', jurisdiction:'UK', vehicle:'AIF', sfdr:'Article 6', stage:'screening', startDate:jul, launchedDate:null, pendingReviews:2, updatedAt:Date.now()-86400000*9, timeline:{policy:jul, kyd:jul+1000*60*60*24*10, esg:jul+1000*60*60*24*20, screening:Date.now()-86400000*9}},
];
};
const loadLaunches = () => {
let list = [];
try { list = JSON.parse(localStorage.getItem(FL_KEY) || '[]'); } catch (e) { list = []; }
if (!list.length) { list = seedLaunches(); localStorage.setItem(FL_KEY, JSON.stringify(list)); }
return list;
};
let launches = loadLaunches();

const active = launches.filter(l => l.stage !== 'launched');
const completed = launches.filter(l => l.stage === 'launched');
const activeYTD = active.filter(l => inYear(l.startDate)).length;
const activeMTD = active.filter(l => inMonth(l.startDate)).length;
const doneYTD = completed.filter(l => inYear(l.launchedDate)).length;
const doneMTD = completed.filter(l => inMonth(l.launchedDate)).length;
const avgYTD = mean(completed.filter(l=> inYear(l.launchedDate)).map(l => daysBetween(l.startDate, l.launchedDate)));
const avgMTD = mean(completed.filter(l=> inMonth(l.launchedDate)).map(l => daysBetween(l.startDate, l.launchedDate)));
const pendYTD = active.filter(l=> inYear(l.startDate)).reduce((a,l)=>a+(l.pendingReviews||0),0);
const pendMTD = active.filter(l=> inMonth(l.startDate)).reduce((a,l)=>a+(l.pendingReviews||0),0);
$('#flActiveYTD').textContent = activeYTD; $('#flActiveMTD').textContent = activeMTD;
$('#flDoneYTD').textContent = doneYTD; $('#flDoneMTD').textContent = doneMTD;
$('#flAvgYTD').textContent = showAvg(avgYTD); $('#flAvgMTD').textContent = showAvg(avgMTD);
$('#flPendYTD').textContent = pendYTD; $('#flPendMTD').textContent = pendMTD;

const fBody = $('#fundTable tbody');
const stageBadge = (s) => {
const m = {policy:'task', distributor:'warn', esg:'warn', screening:'info', launched:'ok', intake:'task'};
const cls = m[s] || 'task'; const label = s ? s[0].toUpperCase()+s.slice(1) : '‚Äî';
return `<span class="badge ${cls}">${label}</span>`;
};
fBody.innerHTML = launches.map(l => `
   <tr data-id="${l.id}" style="cursor:pointer" data-pending="${l.pendingReviews||0}" data-days="${daysBetween(l.startDate, l.launchedDate || Date.now())}">
     <td>${l.id}</td><td>${l.name}</td><td>${stageBadge(l.stage)}</td><td>${l.jurisdiction}</td>
     <td>${l.vehicle}</td><td>${l.pendingReviews||0}</td><td>${daysBetween(l.startDate, l.launchedDate || Date.now())}</td><td>${fmtTS(l.updatedAt)}</td>
   </tr>`).join('');
fBody.querySelectorAll('tr').forEach(tr => tr.addEventListener('click', () => {
const l = launches.find(x => x.id === tr.getAttribute('data-id'));
if (!l) return;
const tl = l.timeline || {};
const steps = [
{key:'policy', label:'Policy', ts: tl.policy ?? l.startDate},
{key:'kyd', label:'KYD', ts: tl.kyd ?? null},
{key:'esg', label:'ESG', ts: tl.esg ?? null},
{key:'screening', label:'Screening', ts: tl.screening ?? null},
{key:'launch', label:'Launch', ts: tl.launch ?? l.launchedDate ?? null},
];
const tlHtml = steps.map((s, i) => {
const done = !!s.ts;
const timeTxt = done ? new Date(s.ts).toLocaleString() : '‚Äî';
return `
       <div class="tl-step ${done ? 'done':'pending'}">
         <div class="tl-dot"></div>
         <div class="tl-label">${s.label}</div>
         <div class="tl-time">${timeTxt}</div>
       </div>
       ${i < steps.length - 1 ? '<div class="tl-line"></div>' : ''}
     `;
}).join('');
openModal(`Fund Launch ${l.id}`, `
     <div class="row small"><div style="width:140px">Name</div><div>${l.name}</div></div>
     <div class="row small"><div style="width:140px">Jurisdiction</div><div>${l.jurisdiction}</div></div>
     <div class="row small"><div style="width:140px">Vehicle</div><div>${l.vehicle}</div></div>
     <div class="row small"><div style="width:140px">SFDR</div><div>${l.sfdr||'‚Äî'}</div></div>
     <div class="row small"><div style="width:140px">Stage</div><div>${l.stage}</div></div>
     <div class="row small"><div style="width:140px">Pending reviews</div><div>${l.pendingReviews||0}</div></div>
     <div class="row small"><div style="width:140px">Started</div><div>${fmtTS(l.startDate)}</div></div>
     <div class="row small"><div style="width:140px">Launched</div><div>${fmtTS(l.launchedDate)}</div></div>
     <hr class="sep"/>
     <div class="small"><b>Timeline</b></div>
     <div class="timeline">${tlHtml}</div>
     <div class="actions"><a class="btn" href="fund-launch.html#${l.id}">Open in Fund Launch</a></div>
   `);
}));

// React to changes
window.addEventListener('storage', (e) => {
if (e.key === FL_KEY || e.key === DT_KEY) location.reload();
});

  // Chat to Onboard functionality
  const chatBtn = document.getElementById('chatToOnboardBtn');
  const chatModal = document.getElementById('chatModal');
  
  chatBtn.addEventListener('click', () => {
    chatModal.classList.remove('hidden');
  });
  
  // Close chat modal when clicking outside
  chatModal.addEventListener('click', (e) => {
    if (e.target === chatModal) {
      chatModal.classList.add('hidden');
    }
  });
  
  // Close chat modal with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !chatModal.classList.contains('hidden')) {
      chatModal.classList.add('hidden');
    }
  });

  // Off-canvas sidebar toggle (mobile)
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  const sidebar = document.querySelector('.sidebar');
  const body = document.body;
  let scrollY = 0;

  const openSidebar = () => {
    scrollY = window.scrollY;
    body.classList.add('nav-open');
    body.style.overflow = 'hidden';
    body.style.position = 'fixed';
    body.style.width = '100%';
    body.style.top = `-${scrollY}px`;
  };

  const closeSidebar = () => {
    body.classList.remove('nav-open');
    body.style.removeProperty('overflow');
    body.style.removeProperty('position');
    body.style.removeProperty('width');
    body.style.removeProperty('top');
    window.scrollTo(0, scrollY);
  };

  if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', () => {
      if (body.classList.contains('nav-open')) {
        closeSidebar();
      } else {
        openSidebar();
      }
    });

    // Close on backdrop click
    body.addEventListener('click', (e) => {
      if (body.classList.contains('nav-open') && 
          !sidebar.contains(e.target) && 
          !mobileMenuBtn.contains(e.target)) {
        closeSidebar();
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && body.classList.contains('nav-open')) {
        closeSidebar();
      }
    });
  }

  // Dark mode toggle
  const themeToggle = document.getElementById('themeToggle');
  const THEME_KEY = 'preferred_theme';

  const applyTheme = (theme) => {
    if (theme === 'dark') {
      body.classList.add('dark-theme');
      if (themeToggle) themeToggle.textContent = '‚òÄÔ∏è';
      if (themeToggle) themeToggle.setAttribute('aria-label', 'Switch to light mode');
    } else {
      body.classList.remove('dark-theme');
      if (themeToggle) themeToggle.textContent = 'üåô';
      if (themeToggle) themeToggle.setAttribute('aria-label', 'Switch to dark mode');
    }
  };

  // Load saved theme preference or detect system preference
  const savedTheme = localStorage.getItem(THEME_KEY);
  if (savedTheme) {
    applyTheme(savedTheme);
  } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    applyTheme('dark');
  }

  // Toggle theme on button click
  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      const isDark = body.classList.contains('dark-theme');
      const newTheme = isDark ? 'light' : 'dark';
      applyTheme(newTheme);
      localStorage.setItem(THEME_KEY, newTheme);
    });
  }

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem(THEME_KEY)) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  }

  // ===== ENHANCED TABLE FUNCTIONALITY =====
  
  // Generic table enhancement function
  const enhanceTable = (tableId, searchInputId, options = {}) => {
    const table = document.getElementById(tableId);
    const searchInput = document.getElementById(searchInputId);
    if (!table || !searchInput) return;

    const tbody = table.querySelector('tbody');
    const headers = table.querySelectorAll('th.sortable');
    let allRows = Array.from(tbody.querySelectorAll('tr'));
    let filteredRows = [...allRows];
    let currentSort = { column: null, direction: 'asc' };

    // Pagination state
    const itemsPerPage = options.itemsPerPage || 10;
    let currentPage = 1;
    const countEl = document.getElementById(options.countId);
    const totalEl = document.getElementById(options.totalId);
    const paginationEl = document.getElementById(options.paginationId);
    const prevBtn = document.getElementById(options.prevBtnId);
    const nextBtn = document.getElementById(options.nextBtnId);
    const currentPageEl = document.getElementById(options.currentPageId);
    const totalPagesEl = document.getElementById(options.totalPagesId);

    // Update display
    const updateDisplay = () => {
      const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageRows = filteredRows.slice(start, end);

      // Hide all rows
      allRows.forEach(row => row.style.display = 'none');
      
      // Show only filtered & paginated rows
      pageRows.forEach(row => row.style.display = '');

      // Update counters
      if (countEl) countEl.textContent = filteredRows.length;
      if (totalEl) totalEl.textContent = allRows.length;

      // Update pagination
      if (paginationEl && filteredRows.length > itemsPerPage) {
        paginationEl.style.display = 'flex';
        if (currentPageEl) currentPageEl.textContent = currentPage;
        if (totalPagesEl) totalPagesEl.textContent = totalPages;
        if (prevBtn) prevBtn.disabled = currentPage === 1;
        if (nextBtn) nextBtn.disabled = currentPage >= totalPages;
      } else if (paginationEl) {
        paginationEl.style.display = 'none';
      }
    };

    // Search functionality
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase().trim();
      
      if (!query) {
        filteredRows = [...allRows];
      } else {
        filteredRows = allRows.filter(row => {
          const text = row.textContent.toLowerCase();
          return text.includes(query);
        });
      }
      
      currentPage = 1; // Reset to first page on search
      updateDisplay();
    });

    // Sort functionality
      const sortTable = (column, direction) => {
      const columnIndex = Array.from(headers).findIndex(h => h.dataset.sort === column);
      if (columnIndex === -1) return;

      filteredRows.sort((a, b) => {
        let aVal = a.cells[columnIndex]?.textContent.trim() || '';
        let bVal = b.cells[columnIndex]?.textContent.trim() || '';

        // Try numeric comparison for specific columns
        if (column === 'age') {
          const aNum = parseInt(a.dataset.age) || 0;
          const bNum = parseInt(b.dataset.age) || 0;
          return direction === 'asc' ? aNum - bNum : bNum - aNum;
        }
        
        if (column === 'risk') {
          const riskMap = { 'High': 3, 'Medium': 2, 'Low': 1, '': 0 };
          const aRisk = riskMap[a.dataset.risk?.toLowerCase() === 'high' ? 'High' : 
                               a.dataset.risk?.toLowerCase() === 'medium' ? 'Medium' : 
                               a.dataset.risk?.toLowerCase() === 'low' ? 'Low' : ''] || 0;
          const bRisk = riskMap[b.dataset.risk?.toLowerCase() === 'high' ? 'High' : 
                               b.dataset.risk?.toLowerCase() === 'medium' ? 'Medium' : 
                               b.dataset.risk?.toLowerCase() === 'low' ? 'Low' : ''] || 0;
          return direction === 'asc' ? aRisk - bRisk : bRisk - aRisk;
        }

        // Numeric columns (pending, days, accepted, onboarding, invested)
        if (['pending', 'days', 'accepted', 'onboarding', 'invested'].includes(column)) {
          const aNum = parseInt(a.dataset[column]) || parseInt(aVal) || 0;
          const bNum = parseInt(b.dataset[column]) || parseInt(bVal) || 0;
          return direction === 'asc' ? aNum - bNum : bNum - aNum;
        }

        // String comparison
        return direction === 'asc' 
          ? aVal.localeCompare(bVal)
          : bVal.localeCompare(aVal);
      });      // Update header indicators
      headers.forEach(h => {
        h.classList.remove('asc', 'desc');
        if (h.dataset.sort === column) {
          h.classList.add(direction);
        }
      });

      updateDisplay();
    };

    // Header click handlers
    headers.forEach(header => {
      header.addEventListener('click', () => {
        const column = header.dataset.sort;
        
        if (currentSort.column === column) {
          // Toggle direction
          currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
          currentSort.column = column;
          currentSort.direction = 'asc';
        }
        
        sortTable(currentSort.column, currentSort.direction);
      });
    });

    // Pagination handlers
    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          updateDisplay();
        }
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredRows.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          updateDisplay();
        }
      });
    }

    // Initial display
    updateDisplay();
  };

  // Enhance Work Queue table
  enhanceTable('queueTable', 'queueSearch', {
    itemsPerPage: 10,
    countId: 'queueCount',
    totalId: 'queueTotal',
    paginationId: 'queuePagination',
    prevBtnId: 'queuePrevPage',
    nextBtnId: 'queueNextPage',
    currentPageId: 'queueCurrentPage',
    totalPagesId: 'queueTotalPages'
  });

  // Enhance Fund tracker table with search & sort
  setTimeout(() => {
    enhanceTable('fundTable', 'fundSearch', { itemsPerPage: 999 });
  }, 200);

  // Enhance Trade tracker table with search & sort
  setTimeout(() => {
    enhanceTable('tradesTracker', 'tradeSearch', { itemsPerPage: 999 });
  }, 200);

  // Progress bars animation
  document.querySelectorAll('.progress > span').forEach(span => {
    const val = span.dataset.value || 0;
    setTimeout(() => {
      span.style.width = val + '%';
      span.style.transition = 'width 0.8s ease';
    }, 100);
  });

  // ===== TOAST NOTIFICATION SYSTEM =====
  const showToast = (message, type = 'info', title = '', duration = 4000) => {
    const container = document.getElementById('toastContainer');
    if (!container) return;

    const icons = {
      success: '‚úì',
      info: '‚Ñπ',
      warn: '‚ö†',
      error: '‚úï'
    };

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <div class="toast-icon">${icons[type] || icons.info}</div>
      <div class="toast-content">
        ${title ? `<div class="toast-title">${title}</div>` : ''}
        <div class="toast-message">${message}</div>
      </div>
      <div class="toast-close">√ó</div>
    `;

    container.appendChild(toast);

    const close = () => {
      toast.style.animation = 'slideInRight 0.3s ease reverse';
      setTimeout(() => toast.remove(), 300);
    };

    toast.querySelector('.toast-close').addEventListener('click', close);
    
    if (duration > 0) {
      setTimeout(close, duration);
    }

    return { close };
  };

  // Make showToast globally accessible
  window.showToast = showToast;

  // ===== DRAG-AND-DROP CARD REORDERING =====
  const initDragAndDrop = () => {
    const cardsContainer = document.getElementById('kpiCards');
    if (!cardsContainer) return;

    const CARD_ORDER_KEY = 'kpi_card_order';
    let draggedCard = null;

    // Load saved order
    const loadCardOrder = () => {
      try {
        const saved = localStorage.getItem(CARD_ORDER_KEY);
        if (saved) {
          const order = JSON.parse(saved);
          const cards = Array.from(cardsContainer.querySelectorAll('.card'));
          
          // Sort cards based on saved order
          const sortedCards = order.map(id => cards.find(c => c.dataset.cardId === id)).filter(Boolean);
          const unsortedCards = cards.filter(c => !order.includes(c.dataset.cardId));
          
          [...sortedCards, ...unsortedCards].forEach(card => cardsContainer.appendChild(card));
        }
      } catch (e) {
        console.warn('Failed to load card order:', e);
      }
    };

    // Save current order
    const saveCardOrder = () => {
      const order = Array.from(cardsContainer.querySelectorAll('.card'))
        .map(card => card.dataset.cardId);
      localStorage.setItem(CARD_ORDER_KEY, JSON.stringify(order));
    };

    // Drag handlers
    cardsContainer.addEventListener('dragstart', (e) => {
      if (e.target.classList.contains('card')) {
        draggedCard = e.target;
        e.target.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      }
    });

    cardsContainer.addEventListener('dragend', (e) => {
      if (e.target.classList.contains('card')) {
        e.target.classList.remove('dragging');
        cardsContainer.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
        saveCardOrder();
        showToast('Card order saved', 'success', '', 2000);
      }
    });

    cardsContainer.addEventListener('dragover', (e) => {
      e.preventDefault();
      const afterElement = getDragAfterElement(cardsContainer, e.clientX, e.clientY);
      const card = document.querySelector('.dragging');
      
      cardsContainer.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
      
      if (afterElement == null) {
        cardsContainer.appendChild(card);
      } else {
        afterElement.classList.add('drag-over');
        cardsContainer.insertBefore(card, afterElement);
      }
    });

    const getDragAfterElement = (container, x, y) => {
      const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = x - box.left - box.width / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    };

    loadCardOrder();
  };

  // ===== CSV/PDF EXPORT FUNCTIONALITY =====
  const exportTableToCSV = (tableId, filename) => {
    const table = document.getElementById(tableId);
    if (!table) return;

    const rows = Array.from(table.querySelectorAll('tr')).filter(row => row.style.display !== 'none');
    const csv = rows.map(row => {
      return Array.from(row.querySelectorAll('th, td')).map(cell => {
        let text = cell.textContent.trim();
        // Escape quotes and wrap in quotes if contains comma
        text = text.replace(/"/g, '""');
        return text.includes(',') ? `"${text}"` : text;
      }).join(',');
    }).join('\n');

    // Download
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showToast('CSV exported successfully', 'success', 'Export Complete');
  };

  const exportTableToPDF = (tableId, filename) => {
    // Simple PDF export using basic HTML rendering
    const table = document.getElementById(tableId);
    if (!table) return;

    const printWindow = window.open('', '_blank');
    const rows = Array.from(table.querySelectorAll('tr')).filter(row => row.style.display !== 'none');
    
    const htmlContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <title>${filename}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          h1 { color: #0b1220; margin-bottom: 20px; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #e5e7eb; padding: 8px 12px; text-align: left; }
          th { background: #f7fafd; font-weight: 600; }
          tr:nth-child(even) { background: #f9fafb; }
          .badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; }
        <\/style>
      <\/head>
      <body>
        <h1>${filename}</h1>
        <p>Generated: ${new Date().toLocaleString()}</p>
        <table>
          ${rows.map(row => `<tr>${Array.from(row.cells).map(cell => 
            row.cells[0] === cell ? `<th>${cell.textContent}</th>` : `<td>${cell.textContent}</td>`
          ).join('')}</tr>`).join('')}
        <\/table>
        <script>
          window.onload = () => {
            window.print();
            setTimeout(() => window.close(), 500);
          };
        <\/script>
      <\/body>
      <\/html>
    `;

    printWindow.document.write(htmlContent);
    printWindow.document.close();

    showToast('Opening PDF print dialog...', 'info', 'Export to PDF');
  };

  // Export button handlers
  const exportQueueCSV = document.getElementById('exportQueueCSV');
  const exportQueuePDF = document.getElementById('exportQueuePDF');
  
  if (exportQueueCSV) {
    exportQueueCSV.addEventListener('click', () => exportTableToCSV('queueTable', 'Work_Queue'));
  }
  
  if (exportQueuePDF) {
    exportQueuePDF.addEventListener('click', () => exportTableToPDF('queueTable', 'Work Queue'));
  }

  // ===== REAL-TIME UPDATES SIMULATION =====
  const initRealTimeUpdates = () => {
    const UPDATE_INTERVAL = 30000; // 30 seconds
    let updateCount = 0;

    const simulateUpdate = () => {
      updateCount++;
      
      // Randomly update a metric (simulation)
      const metrics = [
        { id: 'openTrades', change: Math.random() > 0.5 ? 1 : -1 },
        { id: 'investedCount', change: Math.random() > 0.5 ? 1 : 0 }
      ];

      const randomMetric = metrics[Math.floor(Math.random() * metrics.length)];
      const element = document.getElementById(randomMetric.id);
      
      if (element) {
        const currentValue = parseInt(element.textContent) || 0;
        const newValue = Math.max(0, currentValue + randomMetric.change);
        
        if (newValue !== currentValue) {
          element.textContent = newValue;
          element.style.animation = 'pulse 0.5s ease';
          setTimeout(() => element.style.animation = '', 500);
          
          showToast(`Updated: ${randomMetric.id.replace(/([A-Z])/g, ' $1').trim()}`, 'info', 'Real-time Update', 3000);
        }
      }

      // Check for storage changes from other tabs
      const checkForUpdates = () => {
        window.dispatchEvent(new StorageEvent('storage', {
          key: FL_KEY,
          newValue: localStorage.getItem(FL_KEY)
        }));
      };

      // Listen for updates
      if (updateCount % 3 === 0) {
        checkForUpdates();
      }
    };

    // Start polling
    setInterval(simulateUpdate, UPDATE_INTERVAL);

    // Show initial notification
    setTimeout(() => {
      showToast('Real-time updates enabled', 'success', 'System Ready', 3000);
    }, 2000);
  };

  // Initialize all advanced features
  initDragAndDrop();
  initRealTimeUpdates();
})();
</script>
</body>
</html>
