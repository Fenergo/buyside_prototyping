<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Dashboard Â· KYC Orchestrator</title>
  <style>
:root{
  --sidebar-bg: #f7fafd;
  --sidebar-icon: #4976a4;
  --sidebar-text: #4976a4;
  --sidebar-width: 80px;
  --sidebar-font-size: 12px;
  --sidebar-title-size: 13px;
  --sidebar-tag-size: 10px;
  --sidebar-icon-size: 28px;
  --sidebar-active: #e3eefa;
  --sidebar-width: 170px;
  --sidebar-font-size: 11px;
  --sidebar-title-size: 13px;
  --sidebar-tag-size: 10px;
  --sidebar-icon-size: 18px;
  --page:#ffffff;
  --text:#0f172a;
  --muted:#475569;
  --line:#e5e7eb;
  --card:#ffffff;
  --sidebar: rgba(33,207,178,0.20);
  --btn: rgba(33,207,178,0.60);
  --btn-border: rgba(33,207,178,0.60);
  --btn-text:#0b1220;
  --link:#0ea5e9;
  --task:#a399ff;
  --success:#059669;
  --warn:#d97706;
  --danger:#dc2626;
  --info:#2563eb;
  --progress:#21cfb2;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial; background: var(--page); color:var(--text); line-height:1.45;}
a{color:var(--link); text-decoration:none} a:hover{text-decoration:underline}

.app{display:grid; grid-template-columns: var(--sidebar-width) 1fr; min-height:100vh}
.sidebar {
  background: var(--sidebar-bg);
  border-right: 1px solid var(--line);
  width: var(--sidebar-width);
  min-width: var(--sidebar-width);
  max-width: var(--sidebar-width);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  padding: 0;
}
.sidebar .brand {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 24px 0 0 0;
}
.sidebar .logo {
  width: 36px;
  height: 36px;
  border-radius: 12px;
  background: radial-gradient(circle at 25% 20%, #4976a4 0%, #e3eefa 100%);
  margin-bottom: 8px;
}
.sidebar .brand h1 {
  font-size: 14px;
  color: var(--sidebar-text);
  margin: 0;
  font-weight: 600;
  letter-spacing: 0.2px;
}
.sidebar .nav {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 28px;
  margin-top: 24px;
}
.sidebar .nav a {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  color: var(--sidebar-text);
  text-decoration: none;
  font-size: var(--sidebar-font-size);
  padding: 0;
  border-radius: 8px;
  width: 100%;
  transition: background 0.15s;
}
.sidebar .nav a.active, .sidebar .nav a:hover {
  background: var(--sidebar-active);
}
.sidebar .nav .icon {
  width: var(--sidebar-icon-size);
  height: var(--sidebar-icon-size);
  color: var(--sidebar-icon);
  display: block;
}
.sidebar .nav .text {
  font-size: var(--sidebar-font-size);
  color: var(--sidebar-text);
  text-align: center;
  margin-top: 2px;
}
.sidebar .nav .tag {
  display: none;
}
.sidebar .footer-note {
  margin-top: 10px;
  font-size: 10px;
  color: var(--muted);
  opacity: .85;
  padding: 0 3px;
  margin-bottom: 18px;
}
.header{display:flex; align-items:center; justify-content:space-between; padding:16px 22px; position:sticky; top:0; z-index:5; background:rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-bottom: 1px solid var(--line);}
.search{display:flex; align-items:center; gap:8px; border:1px solid var(--line); background: var(--card); padding:10px 12px; border-radius:12px; width:52%;}
.search input{flex:1; background:transparent; border:none; outline:none; color:var(--text);}
.actions{display:flex; align-items:center; gap:10px}
.btn{background: var(--btn); border:1px solid var(--btn-border); color:var(--btn-text); padding:10px 12px; border-radius:10px; cursor:pointer; transition: filter .15s ease, transform .02s ease;}
.btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)} .btn.primary{background: var(--btn); border-color: var(--btn-border)} .btn.ghost{background:transparent; color: var(--btn-text); border-color: var(--btn-border)} .btn.small{padding:6px 10px; font-size:12px}
.kbd{font: 12px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas; padding:2px 6px; border-radius:6px; border:1px solid var(--line); color:var(--muted)}
.content{padding:14px 22px 40px}
.page-title{display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin:12px 0 8px 0}
.page-title h2{margin:0; font-size:22px}
.page-title .sub{color:var(--muted)}
.cards{display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:14px; margin:14px 0 6px}
.card{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:12px 14px; min-height:72px; box-shadow: 0 8px 28px rgba(2,6,23,.06);}
.card .label{color:var(--muted); font-size:12px} .card .value{font-size:22px; margin-top:2px} .card .trend{font-size:12px; color:#047857} .card .danger{color:var(--danger)}
.grid-2{display:grid; grid-template-columns: 2fr 1fr; gap:16px; margin-top:16px} .grid-3{display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; margin-top:16px}
.section{background: var(--card); border:1px solid var(--line); border-radius:14px; padding:16px} .section h3{margin:0 0 10px 0; font-size:16px}
.table{width:100%; border-collapse:separate; border-spacing:0 8px; font-size:14px}
.table th{color:var(--muted); text-align:left; font-weight:600; padding:8px 10px; border-bottom:1px solid var(--line)}
.table td{padding:10px; background:#ffffff; border:1px solid var(--line)}
.table tr td:first-child{border-top-left-radius:10px; border-bottom-left-radius:10px} .table tr td:last-child{border-top-right-radius:10px; border-bottom-right-radius:10px}
.badge{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; color:#0b1220}
.badge.ok{border-color:#065f46; background:#ecfdf5; color:#065f46} .badge.warn{border-color:#92400e; background:#fffbeb; color:#92400e}
.badge.danger{border-color:#7f1d1d; background:#fef2f2; color:#7f1d1d} .badge.info{border-color:#1e3a8a; background:#eff6ff; color:#1e3a8a} .badge.task{border-color:#6f63ff; background:#a399ff; color:#ffffff}
.pills{display:flex; gap:8px; flex-wrap:wrap}
.pill{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; cursor:pointer; font-size:12px; color:#0b1220}
.pill.active{background:rgba(33,207,178,0.18); border-color:rgba(33,207,178,0.28)}
.progress{width:100%; height:10px; border-radius:999px; background:#f1f5f9; border:1px solid var(--line); overflow:hidden}
.progress > span{display:block; height:100%; background:linear-gradient(90deg, var(--progress), rgba(33,207,178,0.85)); width:0%}
.stepper{display:flex; gap:10px; flex-wrap:wrap}
.step{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; border:1px dashed #94a3b8; background:#f8fafc; color:#0b1220}
.step.current{border-style:solid; background:rgba(33,207,178,0.10)} .step .dot{width:10px; height:10px; border-radius:50%; background:#94a3b8; border:2px solid #cbd5e1}
.step.done .dot{background:#059669; border-color:#059669} .step.current .dot{background:var(--progress)}
.form-grid{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px}
.label{font-size:12px; color:var(--muted); margin-bottom:6px}
.input, select, textarea{width:100%; background:#ffffff; color:var(--text); border:1px solid var(--line); border-radius:10px; padding:10px 12px}
.row{display:flex; gap:10px; align-items:center} hr.sep{border:0; border-top:1px solid var(--line); margin:14px 0}
.right{margin-left:auto} .muted{color:var(--muted)} .small{font-size:12px} .space-top{margin-top:10px} .center{display:flex; align-items:center; justify-content:center} .hidden{display:none!important}
/* Collapsible tracker */
.tracker .head{display:flex; align-items:center; gap:10px; cursor:pointer; user-select:none}
.chev{width:12px; height:12px; border-right:2px solid #334155; border-bottom:2px solid #334155; transform:rotate(45deg); transition: transform .15s ease;}
.tracker.collapsed .chev{transform:rotate(-135deg)}
.tracker .meta{display:flex; gap:12px; flex-wrap:wrap; margin-left:auto}
.stat{display:flex; gap:6px; align-items:center; font-size:12px; border:1px solid var(--line); border-radius:999px; padding:4px 8px; background:#f8fafc}
.stat b{font-weight:700}
.tracker-body{margin-top:10px}
/* Modal */
.modal{position:fixed; inset:0; background:rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; z-index:999}
.modal .box{background:#fff; border-radius:12px; border:1px solid var(--line); width:min(700px, 92vw); padding:16px; box-shadow:0 20px 60px rgba(0,0,0,.25)}
.modal .box h4{margin:0 0 8px 0}
.modal .box .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
/* Mini timeline */
.timeline{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px}
.tl-step{display:flex; flex-direction:column; align-items:center; gap:4px; min-width:90px}
.tl-dot{width:10px; height:10px; border-radius:50%; background:#e2e8f0; border:2px solid #cbd5e1}
.tl-step.done .tl-dot{background:#059669; border-color:#059669}
.tl-step.pending .tl-dot{background:#e2e8f0}
.tl-label{font-size:12px; color:#0f172a}
.tl-time{font-size:11px; color:#475569}
.tl-line{width:28px; height:2px; background:#cbd5e1}
.timeline .tl-step.pending .tl-label{opacity:0.7}
@media (max-width:1100px){ .app{grid-template-columns: 80px 1fr} .brand h1, .footer-note, .nav a .text, .nav a .tag{display:none} .nav a{justify-content:center} .search{width:70%} }
@media (max-width:800px){ .cards{grid-template-columns: repeat(2, 1fr)} .grid-2{grid-template-columns: 1fr} .grid-3{grid-template-columns: 1fr} .form-grid{grid-template-columns: 1fr} }
</style>
</head>
<body data-page="dashboard">
  <a href="#main" class="kbd" style="position:absolute; left:-9999px; top:-9999px">Skip to content</a>
  <div class="app">
    
    <aside class="sidebar" aria-label="Sidebar Navigation">
      <div class="brand">
        <div class="logo" style="padding:0; background:none; border-radius:0; width:auto; height:auto;">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 96 96" role="img" aria-label="Buyside Investments icon A">
            <rect x="0" y="0" width="96" height="96" rx="18" fill="#0F1E41"/>
            <polyline points="16,68 40,44 54,58 78,34" fill="none" stroke="#0BAF82" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"/>
            <polygon points="78,34 66,34 78,22" fill="#0BAF82"/>
          </svg>
        </div>
        <h1>KYC Orchestrator</h1>
      </div>
      <nav class="nav">
        <a href="index.html" data-nav="dashboard" aria-label="Dashboard">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12l9-9 9 9" stroke="#0b1220" stroke-width="1.5"/><path d="M5 10v10h5v-6h4v6h5V10" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Dashboard</span>
        </a>
        <a href="fund-launch.html" data-nav="fund-launch" aria-label="Fund Launch">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 19h16M7 19V7a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v12" stroke="#0b1220" stroke-width="1.5"/><path d="M9 9h6m-6 4h6" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Fund Launch</span>
          <span class="tag">Product</span>
        </a>
        <a href="distributor-onboarding.html" data-nav="distributor" aria-label="Distributor Onboarding">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 8h10a4 4 0 0 1 4 4v6H3v-6a4 4 0 0 1 4-4z" stroke="#0b1220" stroke-width="1.5"/><path d="M7 8V6a5 5 0 0 1 10 0v2" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Distributor Onboarding</span>
          <span class="tag">KYD</span>
        </a>
        <a href="investor-onboarding.html" data-nav="investor" aria-label="Investor Onboarding">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5z" stroke="#0b1220" stroke-width="1.5"/><path d="M3 21a9 9 0 0 1 18 0" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Investor Onboarding</span>
          <span class="tag">KYC/KYB</span>
        </a>
          <a href="Entity-mgmt.html" data-nav="entity" aria-label="Entity Management">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="4" y="4" width="16" height="16" rx="3" stroke="#0b1220" stroke-width="1.5"/><path d="M8 12h8M8 16h8" stroke="#0b1220" stroke-width="1.5"/></svg>
            <span class="text">Entity Management</span>
          </a>
        <a href="asset-dd.html" data-nav="asset" aria-label="Asset & Vehicle Due Diligence">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 7h18M3 12h18M3 17h18" stroke="#0b1220" stroke-width="1.5"/><path d="M8 7v12m8-12v12" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Asset & Vehicle DD</span>
          <span class="tag">KYI</span>
        </a>
        <a href="monitoring.html" data-nav="monitoring" aria-label="Monitoring & Screening">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 13l4 4 12-12" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Monitoring & Screening</span>
          <span class="tag">KYT</span>
        </a>
        <a href="digital-trading.html" data-nav="digital" aria-label="Digital Trading">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6h16v12H4z" stroke="#0b1220" stroke-width="1.5"/><path d="M8 10h8M8 14h5" stroke="#0b1220" stroke-width="1.5"/></svg>
          <span class="text">Digital Trading</span>
          <span class="tag">Trades</span>
        </a>
      </nav>
      <div class="footer-note">Prototype â¢ Static HTML â¢ Local storage</div>
    </aside>
    
    <main class="main">
      <header class="header" role="banner">
        <div class="search" role="search" aria-label="Search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke="#64748b" stroke-width="1.5"/><path d="M20 20l-3-3" stroke="#64748b" stroke-width="1.5"/></svg>
          <input placeholder="Search parties, products, accounts, casesâ¦ (press / to focus)" aria-label="Global search"/>
          <span class="kbd">/</span>
        </div>
        <div class="actions">
          <button class="btn ghost" aria-label="New case">New Case</button>
          <button class="btn primary" aria-label="Add party">+ Add Party</button>
        </div>
      </header>
      <section class="content" id="main">
        <div class="page-title">
          <h2>Home Dashboard</h2>
          <div class="sub">Unified CLM â¢ KYC/KYB/KYD/KYI/KYT â¢ Digital Trading</div>
        </div>
        
<div class="cards" aria-label="KPI cards">
  <div class="card"><div class="label">Median Time-to-KYC</div><div class="value">2.4 days</div><div class="trend">-12% WoW</div></div>
  <div class="card"><div class="label">Open Cases</div><div class="value">128</div><div class="trend">+5 today</div></div>
  <div class="card"><div class="label">High-Risk Parties</div><div class="value danger">17</div><div class="trend">3 require EDD</div></div>
  <div class="card"><div class="="label">Pending Approvals</div><div class="value">34</div><div class="trend">11 overdue</div></div>
  <div class="card"><div class="label">Screening Hits (24h)</div><div class="value">58</div><div class="trend">FPR 7.1%</div></div>
  <div class="card"><div class="label">Open Digital Trades</div><div class="value" id="openTrades">0</div><div class="trend"><span id="investedCount">0</span> invested</div></div>
</div>

<div class="grid-2">
  <div class="section" aria-label="Work Queue">
    <h3>My Work Queue</h3>
    <table class="table" role="table">
      <thead><tr><th>Case ID</th><th>Type</th><th>Party / Product</th><th>Risk</th><th>Age</th><th>Owner</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td>#CA-10482</td><td>Investor KYC</td><td>Riverton Capital SICAV</td><td><span class="badge danger">High</span></td><td>2d</td><td>J. Han</td><td><span class="badge task">Docs requested</span></td></tr>
        <tr><td>#CA-10479</td><td>Distributor KYD</td><td>Alpha Distrib GmbH</td><td><span class="badge warn">Medium</span></td><td>5h</td><td>M. Rossi</td><td><span class="badge ok">Screened</span></td></tr>
        <tr><td>#CA-10463</td><td>Fund Launch</td><td>Northshore Growth AIF</td><td><span class="badge warn">Medium</span></td><td>1d</td><td>S. Patel</td><td><span class="badge task">Awaiting ESG pack</span></td></tr>
        <tr><td>#CA-10451</td><td>Asset DD</td><td>ISIN LU1234567890</td><td><span class="badge">Low</span></td><td>7h</td><td>L. Chen</td><td><span class="badge task">Checks passing</span></td></tr>
        <tr><td>#CA-10437</td><td>Monitoring</td><td>Txn T-998210</td><td><span class="badge danger">High</span></td><td>3h</td><td>Team KYT</td><td><span class="badge task">Escalated</span></td></tr>
      </tbody>
    </table>
  </div>
  <div class="section">
    <h3>Upcoming Reviews</h3>
    <div class="row"><span class="badge warn">Due in 3d</span> Blue Cove Partners LLP â¢ Institutional â¢ <span class="muted">Periodic review (36m)</span></div>
    <div class="row space-top"><span class="badge">Due in 7d</span> Arcturus Family Office â¢ HNW â¢ <span class="muted">UBO refresh</span></div>
    <div class="row space-top"><span class="badge">Due in 9d</span> Solaris Bank AG â¢ Distributor â¢ <span class="muted">KYD re-attestation</span></div>
    <hr class="sep"/>
    <h3>Compliance Health</h3>
    <div class="row small"><div style="width:140px">Sanctions coverage</div><div class="progress" style="flex:1"><span data-value="100"></span></div></div>
    <div class="row small space-top"><div style="width:140px">PEP coverage</div><div class="progress" style="flex:1"><span data-value="100"></span></div></div>
    <div class="row small space-top"><div style="width:140px">Adverse media</div><div class="progress" style="flex:1"><span data-value="84"></span></div></div>
    <div class="row small space-top"><div style="width:140px">ESG data</div><div class="progress" style="flex:1"><span data-value="74"></span></div></div>
  </div>
</div>

<div class="grid-2">
  <!-- Fund Launches Tracker -->
  <div class="section tracker" id="fundTracker">
    <div class="head" id="fundHead">
      <div class="chev" aria-hidden="true"></div>
      <h3>Fund Launches Tracker</h3>
      <div class="meta">
        <span class="stat"><span class="muted">Active</span> <b id="flActiveYTD">0</b> YTD â¢ <b id="flActiveMTD">0</b> MTD</span>
        <span class="stat"><span class="muted">Completed</span> <b id="flDoneYTD">0</b> YTD â¢ <b id="flDoneMTD">0</b> MTD</span>
        <span class="stat"><span class="muted">Avg time to launch</span> <b id="flAvgYTD">â</b> YTD â¢ <b id="flAvgMTD">â</b> MTD</span>
        <span class="stat"><span class="muted">Pending reviews</span> <b id="flPendYTD">0</b> YTD â¢ <b id="flPendMTD">0</b> MTD</span>
      </div>
    </div>
    <div class="tracker-body" id="fundBody">
      <table class="table" id="fundTable">
        <thead><tr><th>ID</th><th>Name</th><th>Stage</th><th>Jurisdiction</th><th>Vehicle</th><th>Pending</th><th>Days since start</th><th>Updated</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="small muted">Click a row to view details, or open <a href="fund-launch.html">Fund Launch</a> to edit/create.</div>
    </div>
  </div>

  <!-- Digital Trades Tracker -->
  <div class="section tracker" id="tradeTracker">
    <div class="head" id="tradeHead">
      <div class="chev" aria-hidden="true"></div>
      <h3>Digital Trades Tracker</h3>
      <div class="meta">
        <span class="stat"><span class="muted">Open</span> <b id="dtOpenYTD">0</b> YTD â¢ <b id="dtOpenMTD">0</b> MTD</span>
        <span class="stat"><span class="muted">Invested</span> <b id="dtInvYTD">0</b> YTD â¢ <b id="dtInvMTD">0</b> MTD</span>
      </div>
    </div>
    <div class="tracker-body" id="tradeBody">
      <table class="table" id="tradesTracker">
        <thead><tr><th>ID</th><th>Name</th><th>Stage</th><th>Accepted</th><th>Onboarding</th><th>Invested</th><th>Updated</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="small muted">Source: local storage. Open <a href="digital-trading.html">Digital Trading</a> to add/edit trades.</div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Detail dialog">
  <div class="box">
    <h4 id="modalTitle">Details</h4>
    <div id="modalBody" class="small"></div>
    <div class="actions"><button class="btn" id="modalClose">Close</button></div>
  </div>
</div>

      </section>
    </main>
  </div>
  <script>
  (() => {
    document.querySelectorAll('.nav a').forEach(a => { if (a.dataset.nav === 'dashboard') a.classList.add('active'); });
  })();
  </script>
  <script>
(() => {
  const now = new Date();
  const y = now.getFullYear(), m = now.getMonth();

  const fmtTS = (ts) => ts ? new Date(ts).toLocaleString() : 'â';
  const daysBetween = (a,b) => Math.max(0, Math.round((b - a) / 86400000));
  const inYear = (ts) => new Date(ts).getFullYear() === y;
  const inMonth = (ts) => { const d = new Date(ts); return d.getFullYear()===y && d.getMonth()===m; };
  const mean = (arr) => arr.length ? Math.round(arr.reduce((a,b)=>a+b,0) / arr.length) : null;
  const showAvg = (v) => v===null ? 'â' : (v + 'd');
  const $ = (sel) => document.querySelector(sel);

  // Collapsible
  const makeCollapsible = (headSel, bodySel, trackerSel) => {
    const head = $(headSel), body = $(bodySel), wrap = $(trackerSel);
    head.addEventListener('click', (e) => {
      if (e.target.closest('a')) return;
      body.classList.toggle('hidden'); wrap.classList.toggle('collapsed');
    });
  };
  makeCollapsible('#fundHead','#fundBody','#fundTracker');
  makeCollapsible('#tradeHead','#tradeBody','#tradeTracker');

  // Modal
  const modal = $('#modal'), modalTitle = $('#modalTitle'), modalBody = $('#modalBody');
  const openModal = (title, html) => { modalTitle.textContent = title; modalBody.innerHTML = html; modal.classList.remove('hidden'); };
  $('#modalClose').addEventListener('click', () => modal.classList.add('hidden'));
  modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

  // Digital Trades
  const DT_KEY = 'kyc_trades';
  const loadTrades = () => {
    let list = [];
    try { list = JSON.parse(localStorage.getItem(DT_KEY) || '[]'); } catch (e) { list = []; }
    if (!list.length) {
      list = [{
        id:'DT-0001', name:'Seed Trade â Sustainable Credit A', closingDate:'2025-10-31',
        stage:'invite', closed:false, terms:'Sample T&Cs ...',
        tags:[{name:'amount',type:'number',required:true},{name:'currency',type:'dropdown',required:true,options:'USD,EUR'}],
        investors:[{email:'investor1@example.com', status:'accepted'}, {email:'investor2@example.com', status:'onboarding'}, {email:'investor3@example.com', status:'invited'}],
        createdAt: Date.now()-86400000*30, updatedAt: Date.now()-3600000
      }];
      localStorage.setItem(DT_KEY, JSON.stringify(list));
    }
    return list;
  };
  const trades = loadTrades();
  const openTrades = trades.filter(t=>!t.closed);
  const investedYTD = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=> i.status==='invested' && inYear(t.updatedAt)).length, 0);
  const investedMTD = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=> i.status==='invested' && inMonth(t.updatedAt)).length, 0);
  const openYTD = openTrades.filter(t=> inYear(t.createdAt)).length;
  const openMTD = openTrades.filter(t=> inMonth(t.createdAt)).length;
  $('#openTrades').textContent = openTrades.length;
  $('#investedCount').textContent = openTrades.reduce((acc,t)=> acc + t.investors.filter(i=>i.status==='invested').length, 0);
  $('#dtOpenYTD').textContent = openYTD; $('#dtOpenMTD').textContent = openMTD;
  $('#dtInvYTD').textContent = investedYTD; $('#dtInvMTD').textContent = investedMTD;

  const tBody = $('#tradesTracker tbody');
  const badge = (stage) => {
    const m = {created:'info', legal:'warn', im:'warn', blueprint:'', invite:'ok', live:'ok'};
    const cls = m[stage] || ''; const label = stage ? stage[0].toUpperCase()+stage.slice(1) : 'â';
    return `<span class="badge ${cls}">${label}</span>`;
  };
  tBody.innerHTML = openTrades.map(t => {
    const a = t.investors.filter(i=>i.status==='accepted').length;
    const o = t.investors.filter(i=>i.status==='onboarding').length;
    const v = t.investors.filter(i=>i.status==='invested').length;
    return `<tr data-id="${t.id}" style="cursor:pointer"><td>${t.id}</td><td>${t.name||'â'}</td><td>${badge(t.stage)}</td><td>${a}</td><td>${o}</td><td>${v}</td><td>${fmtTS(t.updatedAt)}</td></tr>`;
  }).join('');
  tBody.querySelectorAll('tr').forEach(tr => tr.addEventListener('click', () => {
    const t = openTrades.find(x => x.id === tr.getAttribute('data-id'));
    if (!t) return;
    const list = t.investors.map(i => `<li>${i.email} â <b>${i.status}</b></li>`).join('');
    openModal(`Digital Trade ${t.id}`, `
      <div class="row small"><div style="width:140px">Name</div><div>${t.name||'â'}</div></div>
      <div class="row small"><div style="width:140px">Stage</div><div>${t.stage}</div></div>
      <div class="row small"><div style="width:140px">Closing Date</div><div>${t.closingDate||'â'}</div></div>
      <hr class="sep"/>
      <div class="small"><b>Investors</b></div>
      <ul class="small">${list||'<li>None</li>'}</ul>
      <div class="actions"><a class="btn" href="digital-trading.html#${t.id}">Open in Digital Trading</a></div>
    `);
  }));

  // Fund Launches
  const FL_KEY = 'kyc_fund_launches';
  const seedLaunches = () => {
    const now = new Date();
    const jan = new Date(now.getFullYear(),0,15).getTime();
    const mar = new Date(now.getFullYear(),2,5).getTime();
    const jul = new Date(now.getFullYear(),6,10).getTime();
    const aug = new Date(now.getFullYear(),7,22).getTime();
    const thisMon = new Date(now.getFullYear(), now.getMonth(), 2).getTime();
    return [
      {id:'FL-0001', name:'Silver Birch UCITS', jurisdiction:'Ireland', vehicle:'UCITS', sfdr:'Article 8', stage:'launched', startDate:jan, launchedDate:mar, pendingReviews:0, updatedAt:mar, timeline:{policy:jan, kyd:jan+1000*60*60*24*14, esg:new Date(new Date(jan).getFullYear(),1,10).getTime(), screening:new Date(new Date(mar).getFullYear(),2,1).getTime(), launch:mar}},
      {id:'FL-0002', name:'Northshore Growth AIF', jurisdiction:'Luxembourg', vehicle:'AIF', sfdr:'Article 8', stage:'esg', startDate:aug, launchedDate:null, pendingReviews:3, updatedAt:Date.now()-86400000*5, timeline:{policy:aug, kyd:aug+1000*60*60*24*7, esg:Date.now()-86400000*5}},
      {id:'FL-0003', name:'Sustainable Credit A', jurisdiction:'Luxembourg', vehicle:'UCITS', sfdr:'Article 9', stage:'policy', startDate:thisMon, launchedDate:null, pendingReviews:5, updatedAt:Date.now()-86400000*2, timeline:{policy:thisMon}},
      {id:'FL-0004', name:'Global Macro Fund', jurisdiction:'UK', vehicle:'AIF', sfdr:'Article 6', stage:'screening', startDate:jul, launchedDate:null, pendingReviews:2, updatedAt:Date.now()-86400000*9, timeline:{policy:jul, kyd:jul+1000*60*60*24*10, esg:jul+1000*60*60*24*20, screening:Date.now()-86400000*9}},
    ];
  };
  const loadLaunches = () => {
    let list = [];
    try { list = JSON.parse(localStorage.getItem(FL_KEY) || '[]'); } catch (e) { list = []; }
    if (!list.length) { list = seedLaunches(); localStorage.setItem(FL_KEY, JSON.stringify(list)); }
    return list;
  };
  let launches = loadLaunches();

  const active = launches.filter(l => l.stage !== 'launched');
  const completed = launches.filter(l => l.stage === 'launched');
  const activeYTD = active.filter(l => inYear(l.startDate)).length;
  const activeMTD = active.filter(l => inMonth(l.startDate)).length;
  const doneYTD = completed.filter(l => inYear(l.launchedDate)).length;
  const doneMTD = completed.filter(l => inMonth(l.launchedDate)).length;
  const avgYTD = mean(completed.filter(l=> inYear(l.launchedDate)).map(l => daysBetween(l.startDate, l.launchedDate)));
  const avgMTD = mean(completed.filter(l=> inMonth(l.launchedDate)).map(l => daysBetween(l.startDate, l.launchedDate)));
  const pendYTD = active.filter(l=> inYear(l.startDate)).reduce((a,l)=>a+(l.pendingReviews||0),0);
  const pendMTD = active.filter(l=> inMonth(l.startDate)).reduce((a,l)=>a+(l.pendingReviews||0),0);
  $('#flActiveYTD').textContent = activeYTD; $('#flActiveMTD').textContent = activeMTD;
  $('#flDoneYTD').textContent = doneYTD; $('#flDoneMTD').textContent = doneMTD;
  $('#flAvgYTD').textContent = showAvg(avgYTD); $('#flAvgMTD').textContent = showAvg(avgMTD);
  $('#flPendYTD').textContent = pendYTD; $('#flPendMTD').textContent = pendMTD;

  const fBody = $('#fundTable tbody');
  const stageBadge = (s) => {
    const m = {policy:'task', distributor:'warn', esg:'warn', screening:'info', launched:'ok', intake:'task'};
    const cls = m[s] || 'task'; const label = s ? s[0].toUpperCase()+s.slice(1) : 'â';
    return `<span class="badge ${cls}">${label}</span>`;
  };
  fBody.innerHTML = launches.map(l => `
    <tr data-id="${l.id}" style="cursor:pointer">
      <td>${l.id}</td><td>${l.name}</td><td>${stageBadge(l.stage)}</td><td>${l.jurisdiction}</td>
      <td>${l.vehicle}</td><td>${l.pendingReviews||0}</td><td>${daysBetween(l.startDate, l.launchedDate || Date.now())}</td><td>${fmtTS(l.updatedAt)}</td>
    </tr>`).join('');
  fBody.querySelectorAll('tr').forEach(tr => tr.addEventListener('click', () => {
    const l = launches.find(x => x.id === tr.getAttribute('data-id'));
    if (!l) return;
    const tl = l.timeline || {};
    const steps = [
      {key:'policy', label:'Policy', ts: tl.policy ?? l.startDate},
      {key:'kyd', label:'KYD', ts: tl.kyd ?? null},
      {key:'esg', label:'ESG', ts: tl.esg ?? null},
      {key:'screening', label:'Screening', ts: tl.screening ?? null},
      {key:'launch', label:'Launch', ts: tl.launch ?? l.launchedDate ?? null},
    ];
    const tlHtml = steps.map((s, i) => {
      const done = !!s.ts;
      const timeTxt = done ? new Date(s.ts).toLocaleString() : 'â';
      return `
        <div class="tl-step ${done ? 'done':'pending'}">
          <div class="tl-dot"></div>
          <div class="tl-label">${s.label}</div>
          <div class="tl-time">${timeTxt}</div>
        </div>
        ${i < steps.length - 1 ? '<div class="tl-line"></div>' : ''}
      `;
    }).join('');
    openModal(`Fund Launch ${l.id}`, `
      <div class="row small"><div style="width:140px">Name</div><div>${l.name}</div></div>
      <div class="row small"><div style="width:140px">Jurisdiction</div><div>${l.jurisdiction}</div></div>
      <div class="row small"><div style="width:140px">Vehicle</div><div>${l.vehicle}</div></div>
      <div class="row small"><div style="width:140px">SFDR</div><div>${l.sfdr||'â'}</div></div>
      <div class="row small"><div style="width:140px">Stage</div><div>${l.stage}</div></div>
      <div class="row small"><div style="width:140px">Pending reviews</div><div>${l.pendingReviews||0}</div></div>
      <div class="row small"><div style="width:140px">Started</div><div>${fmtTS(l.startDate)}</div></div>
      <div class="row small"><div style="width:140px">Launched</div><div>${fmtTS(l.launchedDate)}</div></div>
      <hr class="sep"/>
      <div class="small"><b>Timeline</b></div>
      <div class="timeline">${tlHtml}</div>
      <div class="actions"><a class="btn" href="fund-launch.html#${l.id}">Open in Fund Launch</a></div>
    `);
  }));

  // React to changes
  window.addEventListener('storage', (e) => {
    if (e.key === FL_KEY || e.key === DT_KEY) location.reload();
  });
})();
</script>
</body>
</html>
